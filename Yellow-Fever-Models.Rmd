---
title: "Final Project"
author: "Nodar Kipshidze, August Eberl, Sarah Price, Suhani Patel"
output:
  html_document:
    code_folding: hide
    highlight: haddock
    theme: yeti
    toc: yes
    toc_float: yes
  word_document:
    toc: yes
  pdf_document:
    toc: yes
---


```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

```{r}
library(deSolve)
library(tidyverse)
library(ggplot2)
library(plotly)
library(ggpubr)
library(cowplot)
library(gganimate)
library(av)
library(scales)
```

### Plot Vaccine Coverage 
```{r}
# Late vaccine rates and associated years;
YFV_vax_r = c(21, 36, 37, 51, 50, 62, 78, 72, 46, 64, 71, 41, 41, 39, 61, 80);
YFV_vax_y = c(2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019);

# Create a dataframe combining our two vectors of data;
YFV_vax = data.frame(YFV_vax_r, YFV_vax_y);

# Create ggplot for time vs. vaccine coverage from source above;
ggplot(YFV_vax, aes(x=YFV_vax_y))+
  geom_line(aes(y=YFV_vax_r), color="forest green", alpha=1)+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="NONE",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  xlab("Year") +
  ylab("Vaccine Coverage (%)")

```
Plot YFV Vaccination Rates;
Source: https://apps.who.int/immunization_monitoring/globalsummary/coverages?c=NGA;

### Model Yellow Fever introduction into Nigeria without any interventions
```{r}

#Base Model with 1 infection
{
 YFV = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
        
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 0.05
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1  #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = Iv0 = 0
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0)

parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH)
times=seq(1,365*100,by=1)
sim=ode(y=state, times=times, func=YFV, parms=parms)

#Save output as a dataframe
YFVmodel1 = as.data.frame(sim)

#Approximate R0 from equilibrium state
R0=1/(tail(YFVmodel1[,'Sh'], 1)/Nh)

#Add effective reproductive number
YFVmodel1$Re = (R0*((YFVmodel1$Sh)/Nh)) 
}

#Base Model with 100 infection
{
 YFV = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
        
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 0.05
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 100  #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = Iv0 = 0
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0)

parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH)
times=seq(1,365*100,by=1)
sim=ode(y=state, times=times, func=YFV, parms=parms)

#Save output as a dataframe
YFVmodel100 = as.data.frame(sim)

#Approximate R0 from equilibrium state
R0=1/(tail(YFVmodel100[,'Sh'], 1)/Nh)

#Add effective reproductive number
YFVmodel100$Re = (R0*((YFVmodel100$Sh)/Nh)) 
}


#Base Model with 1,000 infection
{
 YFV = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
        
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 0.05
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1000  #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = Iv0 = 0
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0)

parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH)
times=seq(1,365*100,by=1)
sim=ode(y=state, times=times, func=YFV, parms=parms)

#Save output as a dataframe
YFVmodel1x = as.data.frame(sim)

#Approximate R0 from equilibrium state
R0=1/(tail(YFVmodel1x[,'Sh'], 1)/Nh)

#Add effective reproductive number
YFVmodel1x$Re = (R0*((YFVmodel1x$Sh)/Nh)) 
}

#Base Model with 10,000 infection
{
 YFV = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
        
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 0.05
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10000  #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = Iv0 = 0
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0)

parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH)
times=seq(1,365*100,by=1)
sim=ode(y=state, times=times, func=YFV, parms=parms)

#Save output as a dataframe
YFVmodel10x = as.data.frame(sim)

#Approximate R0 from equilibrium state
R0=1/(tail(YFVmodel10x[,'Sh'], 1)/Nh)

#Add effective reproductive number
YFVmodel10x$Re = (R0*((YFVmodel10x$Sh)/Nh)) 
}


#Base Model with 100,000 infection
{
 YFV = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
        
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 0.05
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 100000  #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = Iv0 = 0
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0)

parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH)
times=seq(1,365*100,by=1)
sim=ode(y=state, times=times, func=YFV, parms=parms)

#Save output as a dataframe
YFVmodel100x = as.data.frame(sim)

#Approximate R0 from equilibrium state
R0=1/(tail(YFVmodel100x[,'Sh'], 1)/Nh)

#Add effective reproductive number
YFVmodel100x$Re = (R0*((YFVmodel100x$Sh)/Nh)) 
}

(YFVmodel[which.max(YFVmodel$Ih),'Ih']/Nh)*100
(YFVmodel[which.max(YFVmodel$Ih),'CumF']/Nh)*100
(YFVmodel[which.max(YFVmodel$Ih),'CumIn']/Nh)*100
(YFVmodel[which.max(YFVmodel$Ih),'CumIn']/Nh)*100


```

### Base Model Plots
```{r}
# Effective reproductive number for base model;
BaseModel_Re_Anim = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Re, color="Re"))+  
  geom_hline(yintercept=1, color="black", linetype="dotted")+
  geom_text(aes(x=max(time/365), label= round(Re, 2), y=Re, nudge_x=3, hjust=1, show.legend=FALSE, size=4.5)) +
  scale_x_continuous(limits=c(0,100))+
  scale_color_viridis_d()+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("Re")+
  xlab("Time (years)")+
  transition_reveal(time/365)

animate(BaseModel_Re_Anim, duration = 10, fps = 20, width = 1920, height = 1080, res=150, renderer = gifski_renderer())
anim_save("baseModel_Re.gif")

BaseModel_Re = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Re, color="Re"))+  
  geom_hline(yintercept=1, color="black", linetype="dotted")+
  scale_x_continuous(limits=c(0,100))+
  scale_color_viridis_d()+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab(expression(R[e]))+
  xlab("Time (years)")

BaseModel_Ih = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Ih/Nh, color="Ih"))+  
  scale_x_continuous(limits=c(0,100))+
  scale_color_viridis_d()+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("Fraction Infected")+
  xlab("Time (years)")

BaseModel_Ih_Acute = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Ih, color="Ih"))+  
  scale_color_viridis_d()+
  scale_x_continuous(limits=c(0,5), expand=c(0,0))+
  scale_y_continuous(labels=comma)+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("Infected Humans")+
  xlab("Time (years)")

BasdeModel = subplot(BaseModel_Re, BaseModel_Re, shareY=FALSE, shareX=TRUE, titleY=TRUE, margin=0.05) %>% 
  layout(
    title = list(text = "Yellow Fever without Interventions", font = list(size = 16))
  )

hide_legend(BasdeModel)

Base_Combo = ggarrange(BaseModel_Re, BaseModel_Ih,
          labels = c("A", "B"),
          ncol = 2, nrow = 1,
          common.legend = FALSE, legend="none")

ggsave("BaseCombo.png", width = 12, height = 5, units = "in", dpi = 300)

BaseModel_Ih_Sense = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Ih, color="Ih"), linetype="dotted")+  
  geom_line(data = YFVmodel100, aes(y=Ih, color="Ih2"), linetype="dotted")+  
  geom_line(data = YFVmodel10, aes(y=Ih, color="Ih3"), linetype="dotted")+  
  scale_color_viridis_d()+
  scale_x_continuous(limits=c(0,10), expand=c(0,0))+
  scale_y_continuous(labels=comma)+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("Infected Humans")+
  xlab("Time (years)")

# 5 Year Figures;
BM_5YR_Sus = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Sh/Nh, color="Re"))+  
  scale_x_continuous(limits=c(0,5))+
  scale_color_viridis_d()+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("Susceptible Humans")+
  xlab("Time (years)")

BM_5YR_CumInc = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=CumF/Nh, color="Ih"))+  
  scale_x_continuous(limits=c(0,5))+
  scale_color_viridis_d()+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("% Cumulative Incidence")+
  xlab("Time (years)")

BM_5YR_CumFat = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=CumF/Nh, color="Ih"))+  
  scale_x_continuous(limits=c(0,5))+
  scale_color_viridis_d()+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("% Cumulative Mortality")+
  xlab("Time (years)")

BasdeModel_5= subplot(BM_5YR_Sus, BM_5YR_CumInc, BM_5YR_CumFat, shareY=FALSE, shareX=TRUE, titleY=TRUE, margin=0.05) %>% 
  layout(
    title = list(text = "Yellow Fever without Interventions, 5 Year Simulation", font = list(size = 16))
  )

hide_legend(BasdeModel_5)



infectionsBase =  cbind(YFVmodel1$time, 
             YFVmodel1$Ih,
             YFVmodel10$Ih,
             YFVmodel100$Ih,
             YFVmodel1x$Ih,
             YFVmodel10$Ih,
             YFVmodel100x$Ih)


infectionsBase = as.data.frame(infectionsBase)

colnames(infectionsBase) = c("time", 
               "A", "B", "C","D","E","F")

infectionsBase_long <- infectionsBase %>%                                   # Apply pivot_longer function
  pivot_longer(c("A", "B", "C","D","E","F"))

infectionsBase_long

infections.labs = c("1 case- base model", 
             "Constrainted - 10x",
             "Constrainted - 15x",
             "Constrainted - 25x",
             "Constrainted - 50x",
             "Constrainted - 5x",
             "Fractional Dosing (1 Yr) - 10x",
             "Fractional Dosing (1 Yr) - 15",
             "Fractional Dosing (1 Yr) - 25x",
             "Fractional Dosing (1 Yr) - 50x",
             "Fractional Dosing (1 Yr) - 5x",
             "Fractional Dosing (5 Yr) - 10x",
             "Fractional Dosing (5 Yr) - 15",
             "Fractional Dosing (5 Yr) - 25x",
             "Fractional Dosing (5 Yr) - 50x",
             "Fractional Dosing (5 Yr) - 5x",
             "Fractional Dosing (10 Yr) - 10x",
             "Fractional Dosing (10 Yr) - 15",
             "Fractional Dosing (10 Yr) - 25x",
             "Fractional Dosing (10 Yr) - 50x",
             "Fractional Dosing (10 Yr) - 5x",
             "Unlimted - 10x",
             "Unlimted - 15x",
             "Unlimted - 25x",
             "Unlimted - 50x",
             "Unlimted - 5x")


ComparingIh = ggplot(infectionsBase_long, aes(x=time/365, y=value, ))+
  geom_line(aes(color=name))+   
  scale_x_continuous(limits=c(0,5), expand=c(0,0))+
  scale_color_viridis_d("Initial Infections", labels=c("A"="1 case - base model", 
                                                       "B" = "10 cases",
                                                       "C" = "100 cases",
                                                       "D" = "1,000 cases",
                                                       "E" = "10,000 cases",
                                                       "F" = "100,000 cases"))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.80),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("Number Infected")+
  xlab("Time (years)")


ComparingIh = ggplot(DATA=NULL)+
  geom_line(data= YFVmodel1, aes(x=time/365, y=Ih/Nh, color="1"), linetype="dashed")+  
  geom_line(data= YFVmodel10, aes(x=time/365, y=Ih/Nh, color="10"))+  
  geom_line(data= YFVmodel100, aes(x=time/365, y=Ih/Nh, color="100"))+  
  geom_line(data= YFVmodel1x, aes(x=time/365, y=Ih/Nh, color="1x"))+  
  geom_line(data= YFVmodel10x, aes(x=time/365, y=Ih/Nh, color="10x"))+  
  geom_line(data= YFVmodel100x, aes(x=time/365, y=Ih/Nh, color="100x"))+  
  scale_x_continuous(limits=c(0,5), expand=c(0,0))+
  scale_color_viridis_d("Initial Infections", labels=c("1"="1 case - base model", 
                                                       "10" = "10 cases",
                                                       "100" = "100 cases",
                                                       "1x" = "1,000 cases",
                                                       "10x" = "10,000 cases",
                                                       "100x" = "100,000 cases"))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.80),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("Fraction Infected")+
  xlab("Time (years)")

ggsave("DiffInfections.png", width = 8, height = 5, units = "in", dpi = 300)


# 20 Year Figures;
BM_20YR_Sus = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Sh/Nh, color="Re"))+  
  scale_x_continuous(limits=c(0,20))+
  scale_color_viridis_d()+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("Susceptible Humans")+
  xlab("Time (years)")

BM_20YR_CumInc = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=CumF/Nh, color="Ih"))+  
  scale_x_continuous(limits=c(0,20))+
  scale_color_viridis_d()+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("% Cumulative Incidence")+
  xlab("Time (years)")

BM_20YR_CumFat = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=CumF/Nh, color="Ih"))+  
  scale_x_continuous(limits=c(0,20))+
  scale_color_viridis_d()+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position="None",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5)) +
  ylab("% Cumulative Mortality")+
  xlab("Time (years)")

BasdeModel_20= subplot(BM_20YR_Sus, BM_20YR_CumInc, BM_20YR_CumFat, shareY=FALSE, shareX=TRUE, titleY=TRUE, margin=0.05) %>% 
  layout(
    title = list(text = "Yellow Fever without Interventions, 20 Year Simulation", font = list(size = 16))
  )

hide_legend(BasdeModel_20)

Base_Combo2 = ggarrange(BM_5YR_Sus, BM_20YR_Sus, BM_5YR_CumInc, BM_20YR_CumInc, BM_5YR_CumFat, BM_20YR_CumFat, 
          labels = c("A", "B", "C", "D", "E", "F"),
          ncol = 2, nrow = 3,
          common.legend = FALSE, legend="none")

ggsave("BaseCombo2.png", width = 12, height = 8.5, units = "in", dpi = 300)

```

### Model Yellow Fever with vaccine intervention without constraints
```{r}
# 5,000 vax / day
{
YFV_w_vax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0
IR = 1/10

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.56) #Assumes 56% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0

# Initial state conditions;
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=state, times=times0, func=YFV_w_vax, parms=parms)
test = as.data.frame(simTest)

#SET THRESHOLD HERE
threshold=50
Vax=0
Vax2=5000

times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=state, times=times1, func=YFV_w_vax, parms=parms)

times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
simNoVax2=ode(y=state2, times=times2, func=YFV_w_vax, parms=parms)

parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax2)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
          Ev=tail(simNoVax2[,'Ev'],1),
          Iv=tail(simNoVax2[,'Iv'],1),
          Sh=tail(simNoVax2[,'Sh'],1),
          Eh=tail(simNoVax2[,'Eh'],1),
          Ih=tail(simNoVax2[,'Ih'],1),
          Rh=tail(simNoVax2[,'Rh'],1),
          CumF=tail(simNoVax2[,'CumF'],1),
          CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),365*100, by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_vax, parms=parms)

simYFVVax=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save Output
#REMEMBER TO CHANGE THIS TO SAVE EACH OUTPUT!!
model_Vax_NC_5x = as.data.frame(simYFVVax)  
}

# 10,000 vax / day
{
YFV_w_vax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0
IR = 1/10

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.56) #Assumes 56% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0

# Initial state conditions;
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=state, times=times0, func=YFV_w_vax, parms=parms)
test = as.data.frame(simTest)

#SET THRESHOLD HERE
threshold=50
Vax=0
Vax2=10000

times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=state, times=times1, func=YFV_w_vax, parms=parms)

times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
simNoVax2=ode(y=state2, times=times2, func=YFV_w_vax, parms=parms)

parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax2)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
          Ev=tail(simNoVax2[,'Ev'],1),
          Iv=tail(simNoVax2[,'Iv'],1),
          Sh=tail(simNoVax2[,'Sh'],1),
          Eh=tail(simNoVax2[,'Eh'],1),
          Ih=tail(simNoVax2[,'Ih'],1),
          Rh=tail(simNoVax2[,'Rh'],1),
          CumF=tail(simNoVax2[,'CumF'],1),
          CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),365*100, by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_vax, parms=parms)

simYFVVax=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save Output
#REMEMBER TO CHANGE THIS TO SAVE EACH OUTPUT!!
model_Vax_NC_10x = as.data.frame(simYFVVax)  
}

# 15,000 vax / day
{
YFV_w_vax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0
IR = 1/10

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.56) #Assumes 56% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0

# Initial state conditions;
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=state, times=times0, func=YFV_w_vax, parms=parms)
test = as.data.frame(simTest)

#SET THRESHOLD HERE
threshold=50
Vax=0
Vax2=15000

times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=state, times=times1, func=YFV_w_vax, parms=parms)

times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
simNoVax2=ode(y=state2, times=times2, func=YFV_w_vax, parms=parms)

parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax2)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
          Ev=tail(simNoVax2[,'Ev'],1),
          Iv=tail(simNoVax2[,'Iv'],1),
          Sh=tail(simNoVax2[,'Sh'],1),
          Eh=tail(simNoVax2[,'Eh'],1),
          Ih=tail(simNoVax2[,'Ih'],1),
          Rh=tail(simNoVax2[,'Rh'],1),
          CumF=tail(simNoVax2[,'CumF'],1),
          CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),365*100, by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_vax, parms=parms)

simYFVVax=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save Output
#REMEMBER TO CHANGE THIS TO SAVE EACH OUTPUT!!
model_Vax_NC_15x = as.data.frame(simYFVVax)  
}

# 25,000 vax / day
{
YFV_w_vax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0
IR = 1/10

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.56) #Assumes 56% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0

# Initial state conditions;
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=state, times=times0, func=YFV_w_vax, parms=parms)
test = as.data.frame(simTest)

#SET THRESHOLD HERE
threshold=50
Vax=0
Vax2=25000

times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=state, times=times1, func=YFV_w_vax, parms=parms)

times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
simNoVax2=ode(y=state2, times=times2, func=YFV_w_vax, parms=parms)

parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax2)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
          Ev=tail(simNoVax2[,'Ev'],1),
          Iv=tail(simNoVax2[,'Iv'],1),
          Sh=tail(simNoVax2[,'Sh'],1),
          Eh=tail(simNoVax2[,'Eh'],1),
          Ih=tail(simNoVax2[,'Ih'],1),
          Rh=tail(simNoVax2[,'Rh'],1),
          CumF=tail(simNoVax2[,'CumF'],1),
          CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),365*100, by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_vax, parms=parms)

simYFVVax=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save Output
#REMEMBER TO CHANGE THIS TO SAVE EACH OUTPUT!!
model_Vax_NC_25x = as.data.frame(simYFVVax)  
}

# 50,000 vax / day
{
YFV_w_vax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0
IR = 1/10

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.56) #Assumes 56% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0

# Initial state conditions;
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=state, times=times0, func=YFV_w_vax, parms=parms)
test = as.data.frame(simTest)

#SET THRESHOLD HERE
threshold=50
Vax=0
Vax2=50000

times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=state, times=times1, func=YFV_w_vax, parms=parms)

times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
simNoVax2=ode(y=state2, times=times2, func=YFV_w_vax, parms=parms)

parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax2)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
          Ev=tail(simNoVax2[,'Ev'],1),
          Iv=tail(simNoVax2[,'Iv'],1),
          Sh=tail(simNoVax2[,'Sh'],1),
          Eh=tail(simNoVax2[,'Eh'],1),
          Ih=tail(simNoVax2[,'Ih'],1),
          Rh=tail(simNoVax2[,'Rh'],1),
          CumF=tail(simNoVax2[,'CumF'],1),
          CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),365*100, by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_vax, parms=parms)

simYFVVax=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save Output
#REMEMBER TO CHANGE THIS TO SAVE EACH OUTPUT!!
model_Vax_NC_50x = as.data.frame(simYFVVax)  
}

```

##Approximate IAR Reduction
```{R}
RelRedAR = as.data.frame(cbind(test$time, test$Sh, test$Ih, 
                 model_Vax_NC_5x$Sh, model_Vax_NC_5x$Ih,
                 model_Vax_NC_10x$Sh, model_Vax_NC_10x$Ih,
                 model_Vax_NC_15x$Sh, model_Vax_NC_15x$Ih,
                 model_Vax_NC_25x$Sh, model_Vax_NC_25x$Ih,
                 model_Vax_NC_50x$Sh, model_Vax_NC_50x$Ih
                 ))

colnames(RelRedAR) = c("time", "BaseSH", "BaseIH", 
                       "SH_5", "IH_5", 
                       "SH_10", "IH_10",
                       "SH_15", "IH_15",
                       "SH_25", "IH_25", 
                       "SH_50", "IH_50")

RelRedAR$Reduce_5 = (((RelRedAR$IH_5/RelRedAR$SH_5)-(RelRedAR$BaseIH/RelRedAR$BaseSH))/(RelRedAR$BaseIH/RelRedAR$BaseSH))
RelRedAR$Reduce_10 = (((RelRedAR$IH_10/RelRedAR$SH_10)-(RelRedAR$BaseIH/RelRedAR$BaseSH))/(RelRedAR$BaseIH/RelRedAR$BaseSH))
RelRedAR$Reduce_15 = (((RelRedAR$IH_15/RelRedAR$SH_15)-(RelRedAR$BaseIH/RelRedAR$BaseSH))/(RelRedAR$BaseIH/RelRedAR$BaseSH))
RelRedAR$Reduce_25 = (((RelRedAR$IH_25/RelRedAR$SH_25)-(RelRedAR$BaseIH/RelRedAR$BaseSH))/(RelRedAR$BaseIH/RelRedAR$BaseSH))
RelRedAR$Reduce_50 = (((RelRedAR$IH_50/RelRedAR$SH_50)-(RelRedAR$BaseIH/RelRedAR$BaseSH))/(RelRedAR$BaseIH/RelRedAR$BaseSH))


#Approximate R0 from equilibrium state
R0_NoVax=1/(tail(test[,'Sh'], 1)/Nh)
R0_Vnc_5x=1/(tail(model_Vax_NC_5x[,'Sh'], 1)/Nh)
R0_Vnc_10x=1/(tail(model_Vax_NC_10x[,'Sh'], 1)/Nh)
R0_Vnc_15x=1/(tail(model_Vax_NC_15x[,'Sh'], 1)/Nh)
R0_Vnc_25x=1/(tail(model_Vax_NC_25x[,'Sh'], 1)/Nh)
R0_Vnc_50x=1/(tail(model_Vax_NC_50x[,'Sh'], 1)/Nh)

#Add effective reproductive number
test$Re = (R0_NoVax*((test$Sh)/Nh))
model_Vax_NC_5x$Re = (R0_Vnc_5x*((model_Vax_NC_5x$Sh)/Nh))
model_Vax_NC_10x$Re = (R0_Vnc_10x*((model_Vax_NC_10x$Sh)/Nh))
model_Vax_NC_15x$Re = (R0_Vnc_15x*((model_Vax_NC_15x$Sh)/Nh))
model_Vax_NC_25x$Re = (R0_Vnc_25x*((model_Vax_NC_25x$Sh)/Nh))
model_Vax_NC_50x$Re = (R0_Vnc_50x*((model_Vax_NC_50x$Sh)/Nh))

```

###Figures for vaccination without constraints
```{R}
## Figure for number of susceptible over entire 100 years, by vaccinate rates
VaxNC_Susc = ggplot(test, aes(x=time/365))+
  geom_line(aes(y=Sh/Nh, color="NoVax"))+
  geom_line(data=model_Vax_NC_5x, aes(y=Sh/Nh, color="5x"))+
  geom_line(data=model_Vax_NC_10x, aes(y=Sh/Nh, color="10x"))+
  geom_line(data=model_Vax_NC_15x, aes(y=Sh/Nh, color="15x"))+
  geom_line(data=model_Vax_NC_25x, aes(y=Sh/Nh, color="25x"))+
  geom_line(data=model_Vax_NC_50x, aes(y=Sh/Nh, color="50x")) +
  scale_color_viridis_d("Simulation",labels=c('NoVax'='No Vaccine', 
                                              "5x"="5,000/day", 
                                              "10x"="10,000/day", 
                                              "15x"="15,000/day", 
                                              "25x"="25,000/day", 
                                              "50x"="50,000/day"))+
  scale_y_continuous(limits=c(0,Sh0/Nh))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))

ggplotly(VaxNC_Susc) %>% 
  layout(
    xaxis = list(title = "Time (Year)"), 
    yaxis = list(title = "% Susceptible"), 
    title = list(text = "Modelling Vaccination without Constraints", font = list(size = 16))
  )



## Effective Reproductive Number, by vaccinate rates
VaxRe = ggplot(test, aes(x=time/365))+
  geom_line(aes(y=Re, color="NoVax"))+
  geom_line(data=model_Vax_NC_5x, aes(y=Re, color="5x"))+
  geom_line(data=model_Vax_NC_10x, aes(y=Re, color="10x"))+
  geom_line(data=model_Vax_NC_15x, aes(y=Re, color="15x"))+
  geom_line(data=model_Vax_NC_25x, aes(y=Re, color="25x"))+
  geom_line(data=model_Vax_NC_50x, aes(y=Re, color="50x")) +
  geom_hline(yintercept = 1.0, color="black", linetype="dotted")+
  scale_color_viridis_d("Simulation",labels=c('NoVax'='No Vaccine', 
                                              "5x"="5,000/day", 
                                              "10x"="10,000/day", 
                                              "15x"="15,000/day", 
                                              "25x"="25,000/day", 
                                              "50x"="50,000/day"))+
  scale_y_continuous(limits=c(0,2))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))

ggplotly(VaxRe) %>% 
  layout(
    xaxis = list(title = "Time (Year)"), 
    yaxis = list(title = "Re"), 
    title = list(text = "Impact on Effective Reproductive Number", font = list(size = 16))
  )


VaxReShort = ggplot(test, aes(x=time/365))+
  geom_line(aes(y=Re, color="NoVax"))+
  geom_line(data=model_Vax_NC_5x, aes(y=Re, color="5x"))+
  geom_line(data=model_Vax_NC_10x, aes(y=Re, color="10x"))+
  geom_line(data=model_Vax_NC_15x, aes(y=Re, color="15x"))+
  scale_color_viridis_d("Simulation", labels=c("NoVax"="No Vaccine", 
                                              "5x"="5,000/day", 
                                              "10x"="10,000/day", 
                                              "15x"="15,000/day"))+
  #scale_y_continuous(limits=c(0.3,0.6))+
  scale_x_continuous(limits=c(0,5.0))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))

RRIAR_5_Full_NoVC = RelRedAR[2*365,'Reduce_5']
RRIAR_10_Full_NoVC = RelRedAR[2*365,'Reduce_10']
RRIAR_15_Full_NoVC = RelRedAR[2*365,'Reduce_15']
RRIAR_25_Full_NoVC = RelRedAR[2*365,'Reduce_25']
RRIAR_50_Full_NoVC = RelRedAR[2*365,'Reduce_50']

RelIAR = ggplot(data=RelRedAR, aes(x=time/365))+
  geom_line(aes(y=Reduce_5, color="5x"))+
  geom_line(aes(y=Reduce_10, color="10x"))+
  geom_line(aes(y=Reduce_15, color="15x"))+
  geom_line(aes(y=Reduce_25, color="25x"))+
  geom_line(aes(y=Reduce_50, color="50x"))+
  geom_text(label=round(RRIAR_5_Full_VC, 2), aes(x=1.95, y=RRIAR_5_Full_VC), size=3)+
  geom_text(label=round(RRIAR_10_Full_VC, 2), aes(x=1.95, y=RRIAR_10_Full_VC), size=3)+
  geom_text(label=round(RRIAR_15_Full_VC, 2), aes(x=1.95, y=RRIAR_15_Full_VC), size=3)+
  geom_text(label=round(RRIAR_25_Full_VC, 2), aes(x=1.95, y=RRIAR_25_Full_VC), size=3)+
  geom_text(label=round(RRIAR_50_Full_VC, 2), aes(x=1.75, y=-0.68), size=3)+
  scale_color_viridis_d("Simulation", labels=c("5x"="5,000/day", 
                                              "10x"="10,000/day", 
                                              "15x"="15,000/day",
                                              "25x"="25,000/day",
                                              "50x"="50,000/day"))+
  scale_x_continuous(limits=c(1,2))+
  scale_y_continuous(limits=c(-0.75,0), expand=c(0,0),minor_breaks=seq(-0.75,0.0,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab("Relative Reduction IAR")+
  labs(title="Life-Long Immunity: Unlimited Stockpile")

ggsave("RelReducNC.png", width = 11, height = 5, units = "in", dpi = 300)


ggplotly(RelIAR) %>% 
  layout(
    xaxis = list(title = "Time (Year)"), 
    yaxis = list(title = "Relative Reduction IAR"), 
    title = list(text = "Relative Redution on the Infection Attack Rate (IAR)", font = list(size = 16))
  )



## Total deaths, by vaccinate rates
VaxNCtotDeaths = ggplot(test, aes(x=time/365))+
  geom_line(aes(y=CumF/Nh, color="NoVax"))+
  geom_line(data=model_Vax_NC_5x, aes(y=CumF/Nh, color="5x"))+
  geom_line(data=model_Vax_NC_10x, aes(y=CumF/Nh, color="10x"))+
  geom_line(data=model_Vax_NC_15x, aes(y=CumF/Nh, color="15x"))+
  geom_line(data=model_Vax_NC_25x, aes(y=CumF/Nh, color="25x"))+
  geom_line(data=model_Vax_NC_50x, aes(y=CumF/Nh, color="50x")) +
  scale_color_viridis_d("Simulation",labels=c('NoVax'='No Vaccine', 
                                              "5x"="5,000/day", 
                                              "10x"="10,000/day", 
                                              "15x"="15,000/day", 
                                              "25x"="25,000/day", 
                                              "50x"="50,000/day"))+
  scale_y_continuous(limits=c(0,0.35))+
  scale_x_continuous(limits=c(0,20))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))

ggplotly(VaxNCtotDeaths) %>% 
  layout(
    xaxis = list(title = "Time (Year)"), 
    yaxis = list(title = "Cumulative Mortality"), 
    title = list(text = "Total Deaths", font = list(size = 16))
  )


```

### Vaccination with constraint of 6 Million Doses @ 25,000 vaccines/day - no fractional dosing
```{r}
#5,000 doses / day @ 6 million total doses
{YFV_w_vaxReal = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    dCumVaxDis = (Vax*IR)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn, dCumVaxDis))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0
IR = 0

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.56) #Assumes 56% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
CumVaxDis0=0

# Initial state conditions;
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0, CumVaxDis=CumVaxDis0)

# Initialize parameters;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)

#Set sequence of time;
times0=seq(1,365*100,by=1)

# Initialize sim by ODE function;
simTest=ode(y=state, times=times0, func=YFV_w_vaxReal, parms=parms)
test = as.data.frame(simTest)

#SET THRESHOLD HERE
threshold=50
Vax=0
timer=0
CumInCounter=0
VaxCounter=0
VaxLimit=6000000

# For loop, runs the length of our sequence times, which is defined above.

Vax=0
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=state, times=times1, func=YFV_w_vaxReal, parms=parms)

Vax=0
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
    state2=c(Sv=tail(simNoVax[,'Sv'],1), 
             Ev=tail(simNoVax[,'Ev'],1),
             Iv=tail(simNoVax[,'Iv'],1),
             Sh=tail(simNoVax[,'Sh'],1),
             Eh=tail(simNoVax[,'Eh'],1),
             Ih=tail(simNoVax[,'Ih'],1),
             Rh=tail(simNoVax[,'Rh'],1),
             CumF=tail(simNoVax[,'CumF'],1),
             CumIn=tail(simNoVax[,'CumIn'],1),
             CumVaxDis=tail(simNoVax[,'CumVaxDis'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_vaxReal, parms=parms)

Vax=5000
IR=1/10
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
               Ev=tail(simNoVax2[,'Ev'],1),
               Iv=tail(simNoVax2[,'Iv'],1),
               Sh=tail(simNoVax2[,'Sh'],1),
               Eh=tail(simNoVax2[,'Eh'],1),
               Ih=tail(simNoVax2[,'Ih'],1),
               Rh=tail(simNoVax2[,'Rh'],1),
               CumF=tail(simNoVax2[,'CumF'],1),
               CumIn=tail(simNoVax2[,'CumIn'],1),
               CumVaxDis=tail(simNoVax2[,'CumVaxDis'],1))
        timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
        simVax=ode(y=state3, times=timesVax, func=YFV_w_vaxReal, parms=parms)
        
Vax=0
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1),
               CumVaxDis=tail(simVax[,'CumVaxDis'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_vaxReal, parms=parms)
        
simYFVVax=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

model50Fatailites_5xvax6mil = as.data.frame(simYFVVax)}

#10,000 doses / day @ 6 million total doses
{YFV_w_vaxReal = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    dCumVaxDis = (Vax*IR)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn, dCumVaxDis))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0
IR = 0

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.56) #Assumes 56% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
CumVaxDis0=0

# Initial state conditions;
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0, CumVaxDis=CumVaxDis0)

# Initialize parameters;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)

#Set sequence of time;
times0=seq(1,365*100,by=1)

# Initialize sim by ODE function;
simTest=ode(y=state, times=times0, func=YFV_w_vaxReal, parms=parms)
test = as.data.frame(simTest)

#SET THRESHOLD HERE
threshold=50
Vax=0
timer=0
CumInCounter=0
VaxCounter=0
VaxLimit=6000000

# For loop, runs the length of our sequence times, which is defined above.

Vax=0
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=state, times=times1, func=YFV_w_vaxReal, parms=parms)

Vax=0
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
    state2=c(Sv=tail(simNoVax[,'Sv'],1), 
             Ev=tail(simNoVax[,'Ev'],1),
             Iv=tail(simNoVax[,'Iv'],1),
             Sh=tail(simNoVax[,'Sh'],1),
             Eh=tail(simNoVax[,'Eh'],1),
             Ih=tail(simNoVax[,'Ih'],1),
             Rh=tail(simNoVax[,'Rh'],1),
             CumF=tail(simNoVax[,'CumF'],1),
             CumIn=tail(simNoVax[,'CumIn'],1),
             CumVaxDis=tail(simNoVax[,'CumVaxDis'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_vaxReal, parms=parms)

Vax=10000
IR=1/10
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
               Ev=tail(simNoVax2[,'Ev'],1),
               Iv=tail(simNoVax2[,'Iv'],1),
               Sh=tail(simNoVax2[,'Sh'],1),
               Eh=tail(simNoVax2[,'Eh'],1),
               Ih=tail(simNoVax2[,'Ih'],1),
               Rh=tail(simNoVax2[,'Rh'],1),
               CumF=tail(simNoVax2[,'CumF'],1),
               CumIn=tail(simNoVax2[,'CumIn'],1),
               CumVaxDis=tail(simNoVax2[,'CumVaxDis'],1))
        timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
        simVax=ode(y=state3, times=timesVax, func=YFV_w_vaxReal, parms=parms)
        
Vax=0
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1),
               CumVaxDis=tail(simVax[,'CumVaxDis'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_vaxReal, parms=parms)
        
simYFVVax=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

model50Fatailites_10xvax6mil = as.data.frame(simYFVVax)}

#15,000 doses / day @ 6 million total doses
{YFV_w_vaxReal = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    dCumVaxDis = (Vax*IR)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn, dCumVaxDis))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0
IR = 0

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.56) #Assumes 56% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
CumVaxDis0=0

# Initial state conditions;
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0, CumVaxDis=CumVaxDis0)

# Initialize parameters;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)

#Set sequence of time;
times0=seq(1,365*100,by=1)

# Initialize sim by ODE function;
simTest=ode(y=state, times=times0, func=YFV_w_vaxReal, parms=parms)
test = as.data.frame(simTest)

#SET THRESHOLD HERE
threshold=50
Vax=0
timer=0
CumInCounter=0
VaxCounter=0
VaxLimit=6000000

# For loop, runs the length of our sequence times, which is defined above.

Vax=0
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=state, times=times1, func=YFV_w_vaxReal, parms=parms)

Vax=0
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
    state2=c(Sv=tail(simNoVax[,'Sv'],1), 
             Ev=tail(simNoVax[,'Ev'],1),
             Iv=tail(simNoVax[,'Iv'],1),
             Sh=tail(simNoVax[,'Sh'],1),
             Eh=tail(simNoVax[,'Eh'],1),
             Ih=tail(simNoVax[,'Ih'],1),
             Rh=tail(simNoVax[,'Rh'],1),
             CumF=tail(simNoVax[,'CumF'],1),
             CumIn=tail(simNoVax[,'CumIn'],1),
             CumVaxDis=tail(simNoVax[,'CumVaxDis'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_vaxReal, parms=parms)

Vax=15000
IR=1/10
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
               Ev=tail(simNoVax2[,'Ev'],1),
               Iv=tail(simNoVax2[,'Iv'],1),
               Sh=tail(simNoVax2[,'Sh'],1),
               Eh=tail(simNoVax2[,'Eh'],1),
               Ih=tail(simNoVax2[,'Ih'],1),
               Rh=tail(simNoVax2[,'Rh'],1),
               CumF=tail(simNoVax2[,'CumF'],1),
               CumIn=tail(simNoVax2[,'CumIn'],1),
               CumVaxDis=tail(simNoVax2[,'CumVaxDis'],1))
        timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
        simVax=ode(y=state3, times=timesVax, func=YFV_w_vaxReal, parms=parms)
        
Vax=0
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1),
               CumVaxDis=tail(simVax[,'CumVaxDis'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_vaxReal, parms=parms)
        
simYFVVax=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

model50Fatailites_15xvax6mil = as.data.frame(simYFVVax)}

#25,000 doses / day @ 6 million total doses
{YFV_w_vaxReal = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    dCumVaxDis = (Vax*IR)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn, dCumVaxDis))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0
IR = 0

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.56) #Assumes 56% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
CumVaxDis0=0

# Initial state conditions;
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0, CumVaxDis=CumVaxDis0)

# Initialize parameters;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)

#Set sequence of time;
times0=seq(1,365*100,by=1)

# Initialize sim by ODE function;
simTest=ode(y=state, times=times0, func=YFV_w_vaxReal, parms=parms)
test = as.data.frame(simTest)

#SET THRESHOLD HERE
threshold=50
Vax=0
timer=0
CumInCounter=0
VaxCounter=0
VaxLimit=6000000

# For loop, runs the length of our sequence times, which is defined above.

Vax=0
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=state, times=times1, func=YFV_w_vaxReal, parms=parms)

Vax=0
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
    state2=c(Sv=tail(simNoVax[,'Sv'],1), 
             Ev=tail(simNoVax[,'Ev'],1),
             Iv=tail(simNoVax[,'Iv'],1),
             Sh=tail(simNoVax[,'Sh'],1),
             Eh=tail(simNoVax[,'Eh'],1),
             Ih=tail(simNoVax[,'Ih'],1),
             Rh=tail(simNoVax[,'Rh'],1),
             CumF=tail(simNoVax[,'CumF'],1),
             CumIn=tail(simNoVax[,'CumIn'],1),
             CumVaxDis=tail(simNoVax[,'CumVaxDis'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_vaxReal, parms=parms)

Vax=25000
IR=1/10
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
               Ev=tail(simNoVax2[,'Ev'],1),
               Iv=tail(simNoVax2[,'Iv'],1),
               Sh=tail(simNoVax2[,'Sh'],1),
               Eh=tail(simNoVax2[,'Eh'],1),
               Ih=tail(simNoVax2[,'Ih'],1),
               Rh=tail(simNoVax2[,'Rh'],1),
               CumF=tail(simNoVax2[,'CumF'],1),
               CumIn=tail(simNoVax2[,'CumIn'],1),
               CumVaxDis=tail(simNoVax2[,'CumVaxDis'],1))
        timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
        simVax=ode(y=state3, times=timesVax, func=YFV_w_vaxReal, parms=parms)
        
Vax=0
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1),
               CumVaxDis=tail(simVax[,'CumVaxDis'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_vaxReal, parms=parms)
        
simYFVVax=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

model50Fatailites_25xvax6mil = as.data.frame(simYFVVax)}

#50,000 doses / day @ 6 million total doses
{YFV_w_vaxReal = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    dCumVaxDis = (Vax*IR)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dCumF, dCumIn, dCumVaxDis))
  })
}

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0
IR = 0

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.56) #Assumes 56% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 10 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
CumVaxDis0=0

# Initial state conditions;
state=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, CumF=CumF0, CumIn=CumIn0, CumVaxDis=CumVaxDis0)

# Initialize parameters;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)

#Set sequence of time;
times0=seq(1,365*100,by=1)

# Initialize sim by ODE function;
simTest=ode(y=state, times=times0, func=YFV_w_vaxReal, parms=parms)
test = as.data.frame(simTest)

#SET THRESHOLD HERE
threshold=50
Vax=0
timer=0
CumInCounter=0
VaxCounter=0
VaxLimit=6000000

# For loop, runs the length of our sequence times, which is defined above.

Vax=0
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=state, times=times1, func=YFV_w_vaxReal, parms=parms)

Vax=0
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
    state2=c(Sv=tail(simNoVax[,'Sv'],1), 
             Ev=tail(simNoVax[,'Ev'],1),
             Iv=tail(simNoVax[,'Iv'],1),
             Sh=tail(simNoVax[,'Sh'],1),
             Eh=tail(simNoVax[,'Eh'],1),
             Ih=tail(simNoVax[,'Ih'],1),
             Rh=tail(simNoVax[,'Rh'],1),
             CumF=tail(simNoVax[,'CumF'],1),
             CumIn=tail(simNoVax[,'CumIn'],1),
             CumVaxDis=tail(simNoVax[,'CumVaxDis'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_vaxReal, parms=parms)

Vax=50000
IR=1/10
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
               Ev=tail(simNoVax2[,'Ev'],1),
               Iv=tail(simNoVax2[,'Iv'],1),
               Sh=tail(simNoVax2[,'Sh'],1),
               Eh=tail(simNoVax2[,'Eh'],1),
               Ih=tail(simNoVax2[,'Ih'],1),
               Rh=tail(simNoVax2[,'Rh'],1),
               CumF=tail(simNoVax2[,'CumF'],1),
               CumIn=tail(simNoVax2[,'CumIn'],1),
               CumVaxDis=tail(simNoVax2[,'CumVaxDis'],1))
        timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
        simVax=ode(y=state3, times=timesVax, func=YFV_w_vaxReal, parms=parms)
        
Vax=0
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1),
               CumVaxDis=tail(simVax[,'CumVaxDis'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_vaxReal, parms=parms)
        
simYFVVax=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

model50Fatailites_50xvax6mil = as.data.frame(simYFVVax)}
```

###Estimate the R0 and IAR for Vaccine with Constraints
```{R}
#Approximate R0 from equilibrium state
R0_NoVax=1/(tail(test[,'Sh'], 1)/Nh)
R0_Vax6_5x=1/(tail(model50Fatailites_5xvax6mil[,'Sh'], 1)/Nh)
R0_Vax6_10x=1/(tail(model50Fatailites_10xvax6mil[,'Sh'], 1)/Nh)
R0_Vax6_15x=1/(tail(model50Fatailites_15xvax6mil[,'Sh'], 1)/Nh)
R0_Vax6_25x=1/(tail(model50Fatailites_25xvax6mil[,'Sh'], 1)/Nh)
R0_Vax6_50x=1/(tail(model50Fatailites_50xvax6mil[,'Sh'], 1)/Nh)

#Add effective reproductive number
test$Re = (R0_NoVax*((test$Sh)/Nh))
model50Fatailites_5xvax6mil$Re = (R0_Vax6_5x*((model50Fatailites_5xvax6mil$Sh)/Nh))
model50Fatailites_10xvax6mil$Re = (R0_Vax6_10x*((model50Fatailites_10xvax6mil$Sh)/Nh))
model50Fatailites_15xvax6mil$Re = (R0_Vax6_15x*((model50Fatailites_15xvax6mil$Sh)/Nh))
model50Fatailites_25xvax6mil$Re = (R0_Vax6_25x*((model50Fatailites_25xvax6mil$Sh)/Nh))
model50Fatailites_50xvax6mil$Re = (R0_Vax6_50x*((model50Fatailites_50xvax6mil$Sh)/Nh))

#Create a dataframe to hold S and I of each model
RelRedAR_Vax_VC = as.data.frame(cbind(test$time, test$Sh, test$Ih, 
                 model50Fatailites_5xvax6mil$Sh, model50Fatailites_5xvax6mil$Ih,
                 model50Fatailites_10xvax6mil$Sh, model50Fatailites_10xvax6mil$Ih,
                 model50Fatailites_15xvax6mil$Sh, model50Fatailites_15xvax6mil$Ih,
                 model50Fatailites_25xvax6mil$Sh, model50Fatailites_25xvax6mil$Ih,
                 model50Fatailites_50xvax6mil$Sh, model50Fatailites_50xvax6mil$Ih
                 ))

#Set column names
colnames(RelRedAR_Vax_VC) = c("time", "BaseSH", "BaseIH", 
                       "SH_5", "IH_5", 
                       "SH_10", "IH_10",
                       "SH_15", "IH_15",
                       "SH_25", "IH_25", 
                       "SH_50", "IH_50")

# Calculate reduction
# Relative reduction IAR = New IAR - Base IAR / Base IAR
RelRedAR_Vax_VC$Reduce_5 = (((RelRedAR_Vax_VC$IH_5/RelRedAR_Vax_VC$SH_5)-(RelRedAR_Vax_VC$BaseIH/RelRedAR_Vax_VC$BaseSH))/(RelRedAR$BaseIH/RelRedAR_Vax_VC$BaseSH))
RelRedAR_Vax_VC$Reduce_10 = (((RelRedAR_Vax_VC$IH_10/RelRedAR_Vax_VC$SH_10)-(RelRedAR_Vax_VC$BaseIH/RelRedAR_Vax_VC$BaseSH))/(RelRedAR$BaseIH/RelRedAR_Vax_VC$BaseSH))
RelRedAR_Vax_VC$Reduce_15 = (((RelRedAR_Vax_VC$IH_15/RelRedAR_Vax_VC$SH_15)-(RelRedAR_Vax_VC$BaseIH/RelRedAR_Vax_VC$BaseSH))/(RelRedAR$BaseIH/RelRedAR_Vax_VC$BaseSH))
RelRedAR_Vax_VC$Reduce_25 = (((RelRedAR_Vax_VC$IH_25/RelRedAR_Vax_VC$SH_25)-(RelRedAR_Vax_VC$BaseIH/RelRedAR_Vax_VC$BaseSH))/(RelRedAR$BaseIH/RelRedAR_Vax_VC$BaseSH))
RelRedAR_Vax_VC$Reduce_50 = (((RelRedAR_Vax_VC$IH_50/RelRedAR_Vax_VC$SH_50)-(RelRedAR_Vax_VC$BaseIH/RelRedAR_Vax_VC$BaseSH))/(RelRedAR$BaseIH/RelRedAR_Vax_VC$BaseSH))
```

###Plot for IAR
```{R}

RRIAR_5_Full_VC = RelRedAR_Vax_VC[2*365,'Reduce_5']
RRIAR_10_Full_VC = RelRedAR_Vax_VC[2*365,'Reduce_10']
RRIAR_15_Full_VC = RelRedAR_Vax_VC[2*365,'Reduce_15']
RRIAR_25_Full_VC = RelRedAR_Vax_VC[2*365,'Reduce_25']
RRIAR_50_Full_VC = RelRedAR_Vax_VC[2*365,'Reduce_50']

RelIAR_VaxWC = ggplot(data=RelRedAR_Vax_VC, aes(x=time/365))+
  geom_line(aes(y=Reduce_5, color="5x"))+
  geom_line(aes(y=Reduce_10, color="10x"))+
  geom_line(aes(y=Reduce_15, color="15x"))+
  geom_line(aes(y=Reduce_25, color="25x"))+
  geom_line(aes(y=Reduce_50, color="50x"))+
  geom_text(label=round(RRIAR_5_Full_VC, 2), aes(x=1.95, y=RRIAR_5_Full_VC), size=3)+
  geom_text(label=round(RRIAR_10_Full_VC, 2), aes(x=1.95, y=RRIAR_10_Full_VC), size=3)+
  geom_text(label=round(RRIAR_15_Full_VC, 2), aes(x=1.95, y=RRIAR_15_Full_VC), size=3)+
  geom_text(label=round(RRIAR_25_Full_VC, 2), aes(x=1.95, y=RRIAR_25_Full_VC), size=3)+
  geom_text(label=round(RRIAR_50_Full_VC, 2), aes(x=1.75, y=-0.68), size=3)+
  scale_color_viridis_d("Simulation", labels=c("5x"="5,000/day", 
                                              "10x"="10,000/day", 
                                              "15x"="15,000/day",
                                              "25x"="25,000/day",
                                              "50x"="50,000/day"))+
  scale_x_continuous(limits=c(1,2))+
  scale_y_continuous(limits=c(-0.75,0), expand=c(0,0),minor_breaks=seq(-0.75,0.0,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab("Relative Reduction IAR")+
  labs(title="Life-Long Immunity: Stockpile Constrainted")

VaxDays5 = (model50Fatailites_5xvax6mil[(which.max(model50Fatailites_5xvax6mil$CumVaxDis)),'time']/365)
VaxDays10 = (model50Fatailites_10xvax6mil[(which.max(model50Fatailites_10xvax6mil$CumVaxDis)),'time']/365)
VaxDays15 = (model50Fatailites_15xvax6mil[(which.max(model50Fatailites_15xvax6mil$CumVaxDis)),'time']/365)
VaxDays25 = (model50Fatailites_25xvax6mil[(which.max(model50Fatailites_25xvax6mil$CumVaxDis)),'time']/365)
VaxDays50 = (model50Fatailites_50xvax6mil[(which.max(model50Fatailites_50xvax6mil$CumVaxDis)),'time']/365)


ReachingVaxLimit = ggplot(NULL)+
  geom_line(data=model50Fatailites_5xvax6mil, aes(y=CumVaxDis/1000000, x=time/365, color="5x"))+
  geom_line(data=model50Fatailites_10xvax6mil, aes(y=CumVaxDis/1000000, x=time/365, color="10x"))+
  geom_line(data=model50Fatailites_15xvax6mil, aes(y=CumVaxDis/1000000, x=time/365, color="15x"))+
  geom_line(data=model50Fatailites_25xvax6mil, aes(y=CumVaxDis/1000000, x=time/365, color="25x"))+
  geom_line(data=model50Fatailites_50xvax6mil, aes(y=CumVaxDis/1000000, x=time/365, color="50x"))+
  geom_text(aes(x=VaxDays5-5, y=5.5), label=round(VaxDays5,2))+
  geom_text(aes(x=VaxDays10, y=6.2), label=round(VaxDays10,2))+
  geom_text(aes(x=VaxDays15, y=6.2), label=round(VaxDays15,2))+
  geom_text(aes(x=VaxDays25, y=6.2), label=round(VaxDays25,2))+
  geom_text(aes(x=VaxDays50, y=6.2), label=round(VaxDays50,2))+
  scale_color_viridis_d("Simulation", labels=c("5x"="5,000/day", 
                                              "10x"="10,000/day", 
                                              "15x"="15,000/day",
                                              "25x"="25,000/day",
                                              "50x"="50,000/day"))+
  scale_x_continuous(limits=c(156/365,30))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab("Doses Administered (millions)")

ggsave("ReachingStockpiles.png", width = 11, height = 5, units = "in", dpi = 300)


ggsave("RelReducCon6.png", width = 11, height = 5, units = "in", dpi = 300)

```

###Plot for 6 million doses @ 25,000 vaccines/day
```{R}
Vax650xMil_Sus = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=(Sh/Nh)*100, color="NI"), linetype="dotted")+
  geom_line(data=model50Fatailites_50xvax6mil, aes(x=time/365, y=(Sh/Nh)*100, color="VwC"), linetype="solid")+
  geom_line(data=model_Vax_NC_50x, aes(x=time/365, y=(Sh/Nh)*100, color="VwoC"), linetype="dashed")+
  geom_hline(yintercept=(1-0.7167)*100, color="red", linetype="solid", alpha=0.75)+
  geom_text(aes(5,(1-0.7167)*100,label = "1 - % Needed to Vaccinate", vjust = -2.5))+
  scale_color_viridis_d("", labels=c("NI"="No Vaccine", 
                                              "VwC"="Vaccine with Constraints",
                                              "VwoC"="Vaccine without Constraints"))+
  guides(shape = FALSE)+
  scale_x_continuous(limits=c(0,10))+
  scale_y_continuous(limits=c(0,60))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.80),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab(NULL)+
  ylab(NULL)+
  labs(title="50,000 vaccines/day")

Vax625xMil_Sus = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=(Sh/Nh)*100, color="NI"), linetype="dotted")+
  geom_line(data=model50Fatailites_25xvax6mil, aes(x=time/365, y=(Sh/Nh)*100, color="VwC"), linetype="solid")+
  geom_line(data=model_Vax_NC_25x, aes(x=time/365, y=(Sh/Nh)*100, color="VwoC"), linetype="dashed")+
  geom_hline(yintercept=(1-0.7167)*100, color="red", linetype="solid", alpha=0.75)+
  geom_text(aes(5,(1-0.7167)*100,label = "1 - % Needed to Vaccinate", vjust = -2.5))+
  scale_color_viridis_d("", labels=c("NI"="No Vaccine", 
                                              "VwC"="Vaccine with Constraints",
                                              "VwoC"="Vaccine without Constraints"))+
  guides(shape = FALSE)+
  scale_x_continuous(limits=c(0,10))+
  scale_y_continuous(limits=c(0,60))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.80),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab(NULL)+
  ylab(NULL)+
  labs(title="25,000 vaccines/day")

Vax615xMil_Sus = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=(Sh/Nh)*100, color="NI"), linetype="dotted")+
  geom_line(data=model50Fatailites_15xvax6mil, aes(x=time/365, y=(Sh/Nh)*100, color="VwC"), linetype="solid")+
  geom_line(data=model_Vax_NC_15x, aes(x=time/365, y=(Sh/Nh)*100, color="VwoC"), linetype="dashed")+
  geom_hline(yintercept=(1-0.7167)*100, color="red", linetype="solid", alpha=0.75)+
  geom_text(aes(5,(1-0.7167)*100,label = "1 - % Needed to Vaccinate", vjust = -2.5))+
  scale_color_viridis_d("", labels=c("NI"="No Vaccine", 
                                              "VwC"="Vaccine with Constraints",
                                              "VwoC"="Vaccine without Constraints"))+
  guides(shape = FALSE)+
  scale_x_continuous(limits=c(0,10))+
  scale_y_continuous(limits=c(0,60))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.80),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab(NULL)+
  ylab(NULL)+
  labs(title="15,000 vaccines/day")

Vax610xMil_Sus = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=(Sh/Nh)*100, color="NI"), linetype="dotted")+
  geom_line(data=model50Fatailites_10xvax6mil, aes(x=time/365, y=(Sh/Nh)*100, color="VwC"), linetype="solid")+
  geom_line(data=model_Vax_NC_10x, aes(x=time/365, y=(Sh/Nh)*100, color="VwoC"), linetype="dashed")+
  geom_hline(yintercept=(1-0.7167)*100, color="red", linetype="solid", alpha=0.75)+
  geom_text(aes(5,(1-0.7167)*100,label = "1 - % Needed to Vaccinate", vjust = -2.5))+
  scale_color_viridis_d("", labels=c("NI"="No Vaccine", 
                                              "VwC"="Vaccine with Constraints",
                                              "VwoC"="Vaccine without Constraints"))+
  guides(shape = FALSE)+
  scale_x_continuous(limits=c(0,10))+
  scale_y_continuous(limits=c(0,60))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.80),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab(NULL)+
  ylab(NULL)+
  labs(title="10,000 vaccines/day")

Vax65xMil_Sus = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=(Sh/Nh)*100, color="NI"), linetype="dotted")+
  geom_line(data=model50Fatailites_5xvax6mil, aes(x=time/365, y=(Sh/Nh)*100, color="VwC"), linetype="solid")+
  geom_line(data=model_Vax_NC_5x, aes(x=time/365, y=(Sh/Nh)*100, color="VwoC"), linetype="dashed")+
  geom_hline(yintercept=(1-0.7167)*100, color="red", linetype="solid", alpha=0.75)+
  geom_text(aes(5,(1-0.7167)*100,label = "1 - % Needed to Vaccinate", vjust = -2.5))+
  scale_color_viridis_d("", labels=c("NI"="No Vaccine", 
                                              "VwC"="Vaccine with Constraints",
                                              "VwoC"="Vaccine without Constraints"))+
  guides(shape = FALSE)+
  scale_x_continuous(limits=c(0,10))+
  scale_y_continuous(limits=c(0,60))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.80),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab(NULL)+
  ylab("% Proportion Susceptible")+
  labs(title="5,000 vaccines/day")

#Find row with peak incidence
test[which.max(test$Ih),]

Vax65xMil_Infec = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=log(Ih), color="NI"), linetype="dotted")+
  geom_line(data=model50Fatailites_5xvax6mil, aes(x=time/365, y=log(Ih), color="VwC"), linetype="solid")+
  geom_line(data=model_Vax_NC_5x, aes(x=time/365, y=log(Ih), color="VwoC"), linetype="dashed")+
  scale_color_viridis_d("", labels=c("NI"="No Vaccine", 
                                              "VwC"="Vaccine with Constraints",
                                              "VwoC"="Vaccine without Constraints"))+
  guides(shape = FALSE)+
  scale_x_continuous(limits=c(1.5,824/365))+
  scale_y_continuous(limits=c(5,NA))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.30),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab("Log (Infected Human Cases)")

Vax610xMil_Infec = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=log(Ih), color="NI"), linetype="dotted")+
  geom_line(data=model50Fatailites_10xvax6mil, aes(x=time/365, y=log(Ih), color="VwC"), linetype="solid")+
  geom_line(data=model_Vax_NC_10x, aes(x=time/365, y=log(Ih), color="VwoC"), linetype="dashed")+
  scale_color_viridis_d("", labels=c("NI"="No Vaccine", 
                                              "VwC"="Vaccine with Constraints",
                                              "VwoC"="Vaccine without Constraints"))+
  guides(shape = FALSE)+
  scale_x_continuous(limits=c(1.5,824/365))+
  scale_y_continuous(limits=c(5,NA))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.30),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab(NULL)

Vax615xMil_Infec = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=log(Ih), color="NI"), linetype="dotted")+
  geom_line(data=model50Fatailites_15xvax6mil, aes(x=time/365, y=log(Ih), color="VwC"), linetype="solid")+
  geom_line(data=model_Vax_NC_15x, aes(x=time/365, y=log(Ih), color="VwoC"), linetype="dashed")+
  scale_color_viridis_d("", labels=c("NI"="No Vaccine", 
                                              "VwC"="Vaccine with Constraints",
                                              "VwoC"="Vaccine without Constraints"))+
  guides(shape = FALSE)+
  scale_x_continuous(limits=c(1.5,824/365))+
  scale_y_continuous(limits=c(5,NA))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.30),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab(NULL)

Vax625xMil_Infec = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=log(Ih), color="NI"), linetype="dotted")+
  geom_line(data=model50Fatailites_25xvax6mil, aes(x=time/365, y=log(Ih), color="VwC"), linetype="solid")+
  geom_line(data=model_Vax_NC_25x, aes(x=time/365, y=log(Ih), color="VwoC"), linetype="dashed")+
  scale_color_viridis_d("", labels=c("NI"="No Vaccine", 
                                              "VwC"="Vaccine with Constraints",
                                              "VwoC"="Vaccine without Constraints"))+
  guides(shape = FALSE)+
  scale_x_continuous(limits=c(1.5,824/365))+
  scale_y_continuous(limits=c(5,NA))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.30),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab(NULL)


Vax650xMil_Infec = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=log(Ih), color="NI"), linetype="dotted")+
  geom_line(data=model50Fatailites_50xvax6mil, aes(x=time/365, y=log(Ih), color="VwC"), linetype="solid")+
  geom_line(data=model_Vax_NC_50x, aes(x=time/365, y=log(Ih), color="VwoC"), linetype="dashed")+
  scale_color_viridis_d("", labels=c("NI"="No Vaccine", 
                                              "VwC"="Vaccine with Constraints",
                                              "VwoC"="Vaccine without Constraints"))+
  guides(shape = FALSE)+
  scale_x_continuous(limits=c(1.5,824/365))+
  scale_y_continuous(limits=c(5,NA))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        legend.position=c(0.80, 0.30),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab(NULL)

VaxCompareFullDoses = ggarrange(Vax65xMil_Sus, Vax610xMil_Sus, Vax615xMil_Sus, Vax625xMil_Sus, Vax650xMil_Sus, 
                        Vax65xMil_Infec, Vax610xMil_Infec, Vax615xMil_Infec, Vax625xMil_Infec, Vax650xMil_Infec,
          ncol = 5, nrow = 2,
          common.legend = TRUE, legend="right")

VaxCompareFullDoses_InfectOnly = ggarrange(Vax65xMil_Infec, Vax610xMil_Infec, Vax615xMil_Infec, Vax625xMil_Infec, 
                                           Vax650xMil_Infec,
          ncol = 5, nrow = 1,
          common.legend = TRUE, legend="right")

ggsave("VaxCompareFullDosesInfect.png", width = 16, height = 4, units = "in", dpi = 300)


ggsave("VaxCompareFullDoses.png", width = 16, height = 7, units = "in", dpi = 300)


ggplotly(Vax6Mil_Sus) %>% 
  layout(
    xaxis = list(title = "Time"), 
    yaxis = list(title = "Ih/Nh"), 
    title = list(text = "Comparing Impact of Vaccination with 6 Million Dose Constraint", font = list(size = 16))
  )


Vax6Mil_CumFCompBands = ggplot(NULL)+
  geom_line(data=test, aes(x=time/365, y=CumF/Nh, color="No Intervention"))+
  geom_line(data=model50Fatailites_5xvax6mil, aes(x=time/365, y=CumF/Nh, color="Vaccine w/ Constraints - 5x"))+
  geom_line(data=model50Fatailites_10xvax6mil, aes(x=time/365, y=CumF/Nh, color="Vaccine w/ Constraints - 10x"))+
  geom_line(data=model50Fatailites_15xvax6mil, aes(x=time/365, y=CumF/Nh, color="Vaccine w/ Constraints - 15x"))+
  geom_line(data=model50Fatailites_25xvax6mil, aes(x=time/365, y=CumF/Nh, color="Vaccine w/ Constraints - 25x"))+
  geom_line(data=model50Fatailites_50xvax6mil, aes(x=time/365, y=CumF/Nh, color="Vaccine w/ Constraints - 50"))+
  geom_line(data=model_Vax_NC_5x, aes(x=time/365, y=CumF/Nh, color="Vaccine w/o Constraints - 5x"))+
  geom_line(data=model_Vax_NC_10x, aes(x=time/365, y=CumF/Nh, color="Vaccine w/o Constraints - 10x"))+
  geom_line(data=model_Vax_NC_15x, aes(x=time/365, y=CumF/Nh, color="Vaccine w/o Constraints - 15x"))+
  geom_line(data=model_Vax_NC_25x, aes(x=time/365, y=CumF/Nh, color="Vaccine w/o Constraints - 25x"))+
  geom_line(data=model_Vax_NC_50x, aes(x=time/365, y=CumF/Nh, color="Vaccine w/o Constraints - 50x"))+
  scale_color_viridis_d("Simulation",labels=c('No Intervention'='No Vaccine', 
                                              "Vaccine w/o Constraints"="Vaccine without Constraints",
                                              "Vaccine w/ Constraints"="Vaccine with Constraints"))+
  scale_x_continuous(limits=c(0,20))+
  scale_y_continuous(limits=c(0,0.50))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))

ggplotly(Vax6Mil_CumFCompBands) %>% 
  layout(
    xaxis = list(title = "Time"), 
    yaxis = list(title = "Cumulative Mortality"), 
    title = list(text = "Comparing Impact of Vaccination with 6 Million Dose Constraint @ Different Vaccination Rates", font = list(size = 16))
  )
```

###Fractional Dosing Model + Constraint of 30 million doses
```{r}
#1 Years - 5,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=5000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*1) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),365*100, by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Save here if time to vaccinate takes more than 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC1Yr_model50Fatailites_5000vax20YrWithLimit = as.data.frame(outputSim)}

#5 Years - 5,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=5000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*5) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),365*100, by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Save here if time to vaccinate takes more than 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC5Yr_model50Fatailites_5000vax20YrWithLimit = as.data.frame(outputSim)}

#10 Years - 5,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=5000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*10) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),365*100, by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Save here if time to vaccinate takes more than 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC10Yr_model50Fatailites_5000vax20YrWithLimit = as.data.frame(outputSim)}

#1 Years - 10,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=10000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*1) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC1Yr_model50Fatailites_10000vax20YrWithLimit = as.data.frame(outputSim)}

#5 Years - 10,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=10000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*5) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC5Yr_model50Fatailites_10000vax20YrWithLimit = as.data.frame(outputSim)}

#10 Years - 10,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=10000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*10) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC10Yr_model50Fatailites_10000vax20YrWithLimit = as.data.frame(outputSim)}

#1 Years - 15,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=15000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*1) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC1Yr_model50Fatailites_15000vax20YrWithLimit = as.data.frame(outputSim)}

#5 Years - 15,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=15000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*5) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC5Yr_model50Fatailites_15000vax20YrWithLimit = as.data.frame(outputSim)}

#10 Years - 15,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=15000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*10) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC10Yr_model50Fatailites_15000vax20YrWithLimit = as.data.frame(outputSim)}

#1 Years - 25,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=25000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*1) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC1Yr_model50Fatailites_25000vax20YrWithLimit = as.data.frame(outputSim)}

#5 Years - 25,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=25000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*5) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC5Yr_model50Fatailites_25000vax20YrWithLimit = as.data.frame(outputSim)}

#10 Years - 25,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=25000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*10) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC10Yr_model50Fatailites_25000vax20YrWithLimit = as.data.frame(outputSim)}

#1 Years - 50,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=50000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*1) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC1Yr_model50Fatailites_50000vax20YrWithLimit = as.data.frame(outputSim)}

#5 Years - 50,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=50000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*5) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC5Yr_model50Fatailites_50000vax20YrWithLimit = as.data.frame(outputSim)}

#10 Years - 50,000 / day 
{YFV_w_fracVax = function(time, state, parameters) {
  with(as.list(c(state, parameters)), {
    #Vectors;
    dSv = (Mv*Nv) - (Mv*Sv) - (betaHV * Sv/Nv * Ih)
    dEv = (betaHV * Sv/Nv * Ih) - (av*Ev) - (Mv*Ev)
    dIv = (av*Ev) - (Iv*Mv)
    
    #Humans;
    dSh = (Mhb*Nh) - (Mhd*Sh) - (betaVH * Sh/Nh * Iv) - (Vax*IR) + (Vh*VaxRem)
    dEh = (betaVH * Sh/Nh * Iv) - (ah*Eh) - (Mhd*Eh)
    dIh = (ah*Eh)-((1-p)*gammaH*Ih) - (Mhd*Ih) - (muH*Ih*p)
    dRh = ((1-p)*gammaH*Ih) - (Mhd*Rh)
    dVh = (Vax*IR) - (Vh*VaxRem)
    
    #Cumulative Fatality and Incidence;
    dCumF = (muH*Ih*p)
    dCumIn = (ah*Eh)
    
    #Output;
    list(c(dSv,dEv, dIv, dSh, dEh, dIh, dRh, dVh, dCumF, dCumIn))
  })
}

{

## Parameters for our model;

# Birth/death rates;
# Note, assumes constant birth/death rate for the vector;
# Different rate for birth and deaths for humans;
Mv = 1/20
Mhb = (37/1000)/365 #birth rate for humans;
Mhd = (11.4/1000)/365 #death rate for humans;
Vax=0 # Number vaccinated per day; Initial conditions assumes 0;
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;

# Tranmission coeff.;
betaHV = 0.2
betaVH = 0.25

# Rate from E->I;
av = 1/10
ah = 1/4

# CFR;
p = 0.4683

# Removal rate for humans;
gammaH = 1/4

# Diseased-induced mortality removal rate;
muH = 1/8.5

## Initial Conditions;
Nh = 23000000 #Population of Lagos State, Nigeria;
Nv = Nh*1000
Sh0 = Nh*(1-0.54) #Assumes 54% of the population is already vaccinated against YFV;
Eh0 = Rh0 = 0
Ih0 = 1 #Assumes 1 initial human infections from migration/travel;
CumIn0=Ih0
CumF0=0
Sv0 = Nv
Ev0 = 0
Iv0 = 0
Vh0 = 0

# Initial state conditions;
stateFrac=c(Sv=Sv0, Ev=Ev0, Iv=Iv0, Sh=Sh0, Eh=Eh0, Ih=Ih0, Rh=Rh0, Vh=Vh0, CumF=CumF0, CumIn=CumIn0)

# Initialize parameters;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)

#Set sequence of time;

# Initialize sim by ODE function;
times0=seq(1,365*100,by=1)

simTest=ode(y=stateFrac, times=times0, func=YFV_w_fracVax, parms=parmsFrac)
test = as.data.frame(simTest)

###### SIMULATING SEVERAL SECTIONS OF THE OUTBREAK #####;

# First part of simulation;
threshold=50
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times1=seq(1,min(which(simTest[,'CumF']>threshold)),by=1)
simNoVax=ode(y=stateFrac, times=times1, func=YFV_w_fracVax, parms=parmsFrac)
VaxLimit=30000000

# Response wrap-up;
Vax=0
IR = 0 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 0 #1 year immunity;
parmsFrac=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
times2=seq(tail(simNoVax[,'time'],1),tail(simNoVax[,'time'],1)+30, by=1)
state2=c(Sv=tail(simNoVax[,'Sv'],1), 
          Ev=tail(simNoVax[,'Ev'],1),
          Iv=tail(simNoVax[,'Iv'],1),
          Sh=tail(simNoVax[,'Sh'],1),
          Eh=tail(simNoVax[,'Eh'],1),
          Ih=tail(simNoVax[,'Ih'],1),
          Rh=tail(simNoVax[,'Rh'],1),
          Vh=tail(simNoVax[,'Vh'],1),
          CumF=tail(simNoVax[,'CumF'],1),
          CumIn=tail(simNoVax[,'CumIn'],1))
    simNoVax2=ode(y=state2, times=times2, func=YFV_w_fracVax, parms=parmsFrac);

}
    
# Vax Begins;
Vax=50000
IR = 1/10 #Takes 10 days to confer immunity once vaccinated;
VaxRem = 1/(365*10) ## Years of immunity;
parmsFracwVax=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax, VaxRem=VaxRem, IR=IR)
state3=c(Sv=tail(simNoVax2[,'Sv'],1), 
             Ev=tail(simNoVax2[,'Ev'],1),
             Iv=tail(simNoVax2[,'Iv'],1),
             Sh=tail(simNoVax2[,'Sh'],1),
             Eh=tail(simNoVax2[,'Eh'],1),
             Ih=tail(simNoVax2[,'Ih'],1),
             Rh=tail(simNoVax2[,'Rh'],1),
             Vh=tail(simNoVax2[,'Vh'],1),
             CumF=tail(simNoVax2[,'CumF'],1),
             CumIn=tail(simNoVax2[,'CumIn'],1))
timesVax=seq(tail(simNoVax2[,'time'],1),tail(simNoVax2[,'time'],1)+(VaxLimit/(Vax*IR)), by=1)
simVax=ode(y=state3, times=timesVax, func=YFV_w_fracVax, parms=parmsFracwVax);

#Post Vax Time;
{
  # Vaccines ran out;
Vax=0
IR = 0 #Back to 0;
parms=c(Mv=Mv, Mhb=Mhb, Mhd=Mhd, betaHV=betaHV, betaVH=betaVH, av=av, ah=ah, p=p, gammaH=gammaH, muH=muH, Vax=Vax)
        state4=c(Sv=tail(simVax[,'Sv'],1), 
               Ev=tail(simVax[,'Ev'],1),
               Iv=tail(simVax[,'Iv'],1),
               Sh=tail(simVax[,'Sh'],1),
               Eh=tail(simVax[,'Eh'],1),
               Ih=tail(simVax[,'Ih'],1),
               Rh=tail(simVax[,'Rh'],1),
                Vh=tail(simVax[,'Vh'],1),
               CumF=tail(simVax[,'CumF'],1),
               CumIn=tail(simVax[,'CumIn'],1))
        timesPostVax=seq(tail(simVax[,'time'],1),365*100, by=1)
        simPostVax=ode(y=state4, times=timesPostVax, func=YFV_w_fracVax, parms=parms)
  
}

#Save here if time to vaccinate takes more than 100 years
#outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,])

#Save here if time to vaccinate < 100 years
outputSim=rbind(simNoVax,simNoVax2[-1,],simVax[-1,], simPostVax[-1,])

#Save to dataframe so it doesn't get lost forever like the Titantic
FRAC10Yr_model50Fatailites_50000vax20YrWithLimit = as.data.frame(outputSim)}
```

###Calculating IAR for Fractional Dosing + Constraint
```{r}
#Create a dataframe to hold S and I of each model
RelRedAR_Vax_Frac_VC = as.data.frame(cbind(test$time, test$Sh, test$Ih, 
                 FRAC1Yr_model50Fatailites_5000vax20YrWithLimit[0:365*100,'Sh'], FRAC1Yr_model50Fatailites_5000vax20YrWithLimit[0:365*100,'Ih'],
                 FRAC1Yr_model50Fatailites_10000vax20YrWithLimit$Sh, FRAC1Yr_model50Fatailites_10000vax20YrWithLimit$Ih,
                 FRAC1Yr_model50Fatailites_15000vax20YrWithLimit$Sh, FRAC1Yr_model50Fatailites_15000vax20YrWithLimit$Ih,
                 FRAC1Yr_model50Fatailites_25000vax20YrWithLimit$Sh, FRAC1Yr_model50Fatailites_25000vax20YrWithLimit$Ih,
                 FRAC1Yr_model50Fatailites_50000vax20YrWithLimit$Sh, FRAC1Yr_model50Fatailites_50000vax20YrWithLimit$Ih,
                 FRAC5Yr_model50Fatailites_5000vax20YrWithLimit[0:365*100,'Sh'], FRAC5Yr_model50Fatailites_5000vax20YrWithLimit[0:365*100,'Ih'],
                 FRAC5Yr_model50Fatailites_10000vax20YrWithLimit$Sh, FRAC5Yr_model50Fatailites_10000vax20YrWithLimit$Ih,
                 FRAC5Yr_model50Fatailites_15000vax20YrWithLimit$Sh, FRAC5Yr_model50Fatailites_15000vax20YrWithLimit$Ih,
                 FRAC5Yr_model50Fatailites_25000vax20YrWithLimit$Sh, FRAC5Yr_model50Fatailites_25000vax20YrWithLimit$Ih,
                 FRAC5Yr_model50Fatailites_50000vax20YrWithLimit$Sh, FRAC5Yr_model50Fatailites_50000vax20YrWithLimit$Ih,
                 FRAC10Yr_model50Fatailites_5000vax20YrWithLimit[0:365*100,'Sh'], FRAC10Yr_model50Fatailites_5000vax20YrWithLimit[0:365*100,'Ih'],
                 FRAC10Yr_model50Fatailites_10000vax20YrWithLimit$Sh, FRAC10Yr_model50Fatailites_10000vax20YrWithLimit$Ih,
                 FRAC10Yr_model50Fatailites_15000vax20YrWithLimit$Sh, FRAC10Yr_model50Fatailites_15000vax20YrWithLimit$Ih,
                 FRAC10Yr_model50Fatailites_25000vax20YrWithLimit$Sh, FRAC10Yr_model50Fatailites_25000vax20YrWithLimit$Ih,
                 FRAC10Yr_model50Fatailites_50000vax20YrWithLimit$Sh, FRAC10Yr_model50Fatailites_50000vax20YrWithLimit$Ih
                 ))

#Set column names
colnames(RelRedAR_Vax_Frac_VC) = c("time", "BaseSH", "BaseIH", 
                       "SH_5_F1YR", "IH_5_F1YR", 
                       "SH_10_F1YR", "IH_10_F1YR",
                       "SH_15_F1YR", "IH_15_F1YR",
                       "SH_25_F1YR", "IH_25_F1YR", 
                       "SH_50_F1YR", "IH_50_F1YR",
                       "SH_5_F5YR", "IH_5_F5YR", 
                       "SH_10_F5YR", "IH_10_F5YR",
                       "SH_15_F5YR", "IH_15_F5YR",
                       "SH_25_F5YR", "IH_25_F5YR", 
                       "SH_50_F5YR", "IH_50_F5YR",
                       "SH_5_F10YR", "IH_5_F10YR", 
                       "SH_10_F10YR", "IH_10_F10YR",
                       "SH_15_F10YR", "IH_15_F10YR",
                       "SH_25_F10YR", "IH_25_F10YR", 
                       "SH_50_F10YR", "IH_50_F10YR")

# Calculate reduction
# Relative reduction IAR = New IAR - Base IAR / Base IAR
RelRedAR_Vax_Frac_VC$Reduce_5_1YR = (((RelRedAR_Vax_Frac_VC$IH_5_F1YR/RelRedAR_Vax_Frac_VC$SH_5_F1YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_10_1YR = (((RelRedAR_Vax_Frac_VC$IH_10_F1YR/RelRedAR_Vax_Frac_VC$SH_10_F1YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_15_1YR = (((RelRedAR_Vax_Frac_VC$IH_15_F1YR/RelRedAR_Vax_Frac_VC$SH_15_F1YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_25_1YR = (((RelRedAR_Vax_Frac_VC$IH_25_F1YR/RelRedAR_Vax_Frac_VC$SH_25_F1YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_50_1YR = (((RelRedAR_Vax_Frac_VC$IH_50_F1YR/RelRedAR_Vax_Frac_VC$SH_50_F1YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_5_5YR = (((RelRedAR_Vax_Frac_VC$IH_5_F5YR/RelRedAR_Vax_Frac_VC$SH_5_F5YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_10_5YR = (((RelRedAR_Vax_Frac_VC$IH_10_F5YR/RelRedAR_Vax_Frac_VC$SH_10_F5YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_15_5YR = (((RelRedAR_Vax_Frac_VC$IH_15_F5YR/RelRedAR_Vax_Frac_VC$SH_15_F5YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_25_5YR = (((RelRedAR_Vax_Frac_VC$IH_25_F5YR/RelRedAR_Vax_Frac_VC$SH_25_F5YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_50_5YR = (((RelRedAR_Vax_Frac_VC$IH_50_F5YR/RelRedAR_Vax_Frac_VC$SH_50_F5YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_5_10YR = (((RelRedAR_Vax_Frac_VC$IH_5_F10YR/RelRedAR_Vax_Frac_VC$SH_5_F10YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_10_10YR = (((RelRedAR_Vax_Frac_VC$IH_10_F10YR/RelRedAR_Vax_Frac_VC$SH_10_F10YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_15_10YR = (((RelRedAR_Vax_Frac_VC$IH_15_F10YR/RelRedAR_Vax_Frac_VC$SH_15_F10YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_25_10YR = (((RelRedAR_Vax_Frac_VC$IH_25_F10YR/RelRedAR_Vax_Frac_VC$SH_25_F10YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
RelRedAR_Vax_Frac_VC$Reduce_50_10YR = (((RelRedAR_Vax_Frac_VC$IH_50_F10YR/RelRedAR_Vax_Frac_VC$SH_50_F10YR)-(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))/(RelRedAR_Vax_Frac_VC$BaseIH/RelRedAR_Vax_Frac_VC$BaseSH))
```

###Plotting fractional dosing effect on IAR
```{r}

VaxDays5 = (model50Fatailites_5xvax6mil[(which.max(model50Fatailites_5xvax6mil$CumVaxDis)),'time']/365)

RRIAR_5_1 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_5_1YR']
RRIAR_10_1 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_10_1YR']
RRIAR_15_1 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_15_1YR']
RRIAR_25_1 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_25_1YR']
RRIAR_50_1 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_50_1YR']

RRIAR_5_5 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_5_5YR']
RRIAR_10_5 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_10_5YR']
RRIAR_15_5 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_15_5YR']
RRIAR_25_5 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_25_5YR']
RRIAR_50_5 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_50_5YR']

RRIAR_5_10 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_5_10YR']
RRIAR_10_10 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_10_10YR']
RRIAR_15_10 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_15_10YR']
RRIAR_25_10 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_25_10YR']
RRIAR_50_10 = RelRedAR_Vax_Frac_VC[2*365,'Reduce_50_10YR']

plot(RelRedAR_Vax_Frac_VC$Reduce_5_1YR)

testFrac = ggplot(data=RelRedAR_Vax_Frac_VC, aes(x=time, y=Reduce_5_1YR)) + geom_line()+ scale_x_continuous(limits=c(0,15), expand=c(0,0))


RelIAR_VaxFrac_1YR = ggplot(data=RelRedAR_Vax_Frac_VC, aes(x=time/365))+
  geom_line(aes(y=Reduce_5_1YR, color="5x"), alpha=0.0)+
  geom_line(aes(y=Reduce_10_1YR, color="10x"))+
  geom_line(aes(y=Reduce_15_1YR, color="15x"))+
  geom_line(aes(y=Reduce_25_1YR, color="25x"))+
  geom_line(aes(y=Reduce_50_1YR, color="50x"))+
  geom_text(label=round(RRIAR_10_1, 2), aes(x=1.95, y=RRIAR_10_1), size=3)+
  geom_text(label=round(RRIAR_15_1, 2), aes(x=1.95, y=RRIAR_15_1), size=3)+
  geom_text(label=round(RRIAR_25_1, 2), aes(x=1.95, y=RRIAR_25_1), size=3)+
  geom_text(label=round(RRIAR_50_1, 2), aes(x=1.95, y=RRIAR_50_1), size=3)+
  scale_color_viridis_d("Simulation", labels=c("5x"="5,000/day", 
                                              "10x"="10,000/day", 
                                              "15x"="15,000/day",
                                              "25x"="25,000/day",
                                              "50x"="50,000/day"))+
  scale_x_continuous(limits=c(1,2), expand=c(0,0))+
  scale_y_continuous(limits=c(-0.75,0), expand=c(0,0),minor_breaks=seq(-0.75,0.0,0.01))+
  #scale_y_continuous(breaks=seq(-0.75, -0.01, by=0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab("Relative Reduction IAR")+
  labs(title="1 Year Immunity")

RelIAR_VaxFrac_5YR = ggplot(data=RelRedAR_Vax_Frac_VC, aes(x=time/365))+
  geom_line(aes(y=Reduce_5_5YR, color="5x"), alpha=0.0)+
  geom_line(aes(y=Reduce_10_5YR, color="10x"))+
  geom_line(aes(y=Reduce_15_5YR, color="15x"))+
  geom_line(aes(y=Reduce_25_5YR, color="25x"))+
  geom_line(aes(y=Reduce_50_5YR, color="50x"))+
  geom_text(label=round(RRIAR_10_5, 2), aes(x=1.95, y=RRIAR_10_5), size=3)+
  geom_text(label=round(RRIAR_15_5, 2), aes(x=1.95, y=RRIAR_15_5), size=3)+
  geom_text(label=round(RRIAR_25_5, 2), aes(x=1.95, y=RRIAR_25_5), size=3)+
  geom_text(label=round(RRIAR_50_5, 2), aes(x=1.95, y=RRIAR_50_5), size=3)+
  scale_color_viridis_d("Simulation", labels=c("5x"="5,000/day", 
                                              "10x"="10,000/day", 
                                              "15x"="15,000/day",
                                              "25x"="25,000/day",
                                              "50x"="50,000/day"))+
  scale_x_continuous(limits=c(1,2), expand=c(0,0))+
  scale_y_continuous(limits=c(-0.75,0), expand=c(0,0),minor_breaks=seq(-0.75,0.0,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab("Relative Reduction IAR")+
  labs(title="5 Year Immunity")

RelIAR_VaxFrac_10YR = ggplot(data=RelRedAR_Vax_Frac_VC, aes(x=time/365))+
  geom_line(aes(y=Reduce_5_10YR, color="5x"), alpha=0.0)+
  geom_line(aes(y=Reduce_10_10YR, color="10x"))+
  geom_line(aes(y=Reduce_15_10YR, color="15x"))+
  geom_line(aes(y=Reduce_25_10YR, color="25x"))+
  geom_line(aes(y=Reduce_50_10YR, color="50x"))+
  geom_text(label=round(RRIAR_10_10, 2), aes(x=1.95, y=RRIAR_10_10), size=3)+
  geom_text(label=round(RRIAR_15_10, 2), aes(x=1.95, y=RRIAR_15_10), size=3)+
  geom_text(label=round(RRIAR_25_10, 2), aes(x=1.95, y=RRIAR_25_10), size=3)+
  geom_text(label=round(RRIAR_50_10, 2), aes(x=1.95, y=RRIAR_50_10), size=3)+
  scale_color_viridis_d("Simulation", labels=c("5x"="5,000/day", 
                                              "10x"="10,000/day", 
                                              "15x"="15,000/day",
                                              "25x"="25,000/day",
                                              "50x"="50,000/day"))+
  scale_x_continuous(limits=c(1,2), expand=c(0,0))+
  scale_y_continuous(limits=c(-0.75,0), expand=c(0,0),minor_breaks=seq(-0.75,0.0,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  xlab("Time (years)")+
  ylab("Relative Reduction IAR")+
  labs(title="10 Year Immunity")

ComparingIARs = ggarrange(RelIAR, RelIAR_VaxWC, RelIAR_VaxFrac_1YR, RelIAR_VaxFrac_5YR, RelIAR_VaxFrac_10YR,
                          labels=c("A", "B","C","D", "E"),
          ncol = 2, nrow = 3,
          common.legend = TRUE, legend="right")

ggsave("1Yr.png", width = 10, height = 7, units = "in", dpi = 300)


ggsave("ComparingAllIARS.png", width = 10, height = 10, units = "in", dpi = 300)
```

## Plots comparing fractional dosing models
```{r}

## Fractional Dosing and % Susceptible Equilibrium
plotFracInfected = ggplot(test, aes(x=time/365))+
  geom_line(aes(y=(Sh/Nh)*100, color="NoVax"))+
  geom_line(data=FRAC1Yr_model50Fatailites_25000vax20YrWithLimit, aes(y=(Sh/Nh)*100, color="1Yr")) +
  geom_line(data=FRAC5Yr_model50Fatailites_25000vax20YrWithLimit, aes(y=(Sh/Nh)*100, color="5Yr")) +
  geom_line(data=FRAC10Yr_model50Fatailites_25000vax20YrWithLimit, aes(y=(Sh/Nh)*100, color="10Yr")) +
  geom_line(data=FRACLifeYr_model50Fatailites_25000vax20YrWithLimit, aes(y=(Sh/Nh)*100, color="Life Long Immunity")) +
  scale_color_viridis_d("Simulation",labels=c('NoVax'='No Vaccine', "1Yr"="1 Year", "5Yr"="5 Years", "10Yr"="10 Years", "Life Long Immunity" = 
                                    "Life Long Immunity"))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))

ggplotly(plotFracInfected) %>% 
  layout(
    xaxis = list(title = "Time"), 
    yaxis = list(title = "% Susceptible"), 
    title = list(text = "Fractional Dosing at Different Levels of Immunity", font = list(size = 16))
  )

## Deaths for Acute Phase
plotFracDeaths = ggplot(test, aes(x=time/365))+
  geom_line(aes(y=CumF/Nh, color="NoVax"))+
  geom_line(data=FRAC1Yr_model50Fatailites_25000vax20YrWithLimit, aes(y=CumF/Nh, color="1Yr")) +
  geom_line(data=FRAC5Yr_model50Fatailites_25000vax20YrWithLimit, aes(y=CumF/Nh, color="5Yr")) +
  geom_line(data=FRAC10Yr_model50Fatailites_25000vax20YrWithLimit, aes(y=CumF/Nh, color="10Yr")) +
  scale_color_viridis_d("Simulation",labels=c('NoVax'='No Vaccine', "1Yr"="1 Year", "5Yr"="5 Years", "10Yr"="10 Years"))+
  scale_x_continuous(limits=c(2,5))+
  scale_y_continuous(limits=c(0,0.15))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))

ggplotly(plotFracDeaths) %>% 
  layout(
    xaxis = list(title = "Time"), 
    yaxis = list(title = "% Cumulative Mortality"), 
    title = list(text = "Total Mortalty in Acute Outbreak", font = list(size = 16))
  )

```

### Final Comparison Figures
```{r}
plot_Comp_5x = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Ih/Nh, color="No Vaccine"))+
  geom_line(data=model_Vax_NC_5x, aes(y=Ih/Nh, color="Full Dose, without Constraints")) +
  geom_line(data=model50Fatailites_5xvax6mil, aes(y=Ih/Nh, color="Full Dose, with constraints")) +
  geom_line(data=FRAC10Yr_model50Fatailites_5000vax20YrWithLimit, aes(y=Ih/Nh, color="Fractional Dose - 10 Years Immunity")) +
  scale_color_viridis_d("Simulation",labels=c('NoVax'='No Vaccine', "1Yr"="1 Year", "5Yr"="5 Years", "10Yr"="10 Years"))+
  scale_x_continuous(limits=c(0,20))+
  scale_y_continuous(limits=c(0,0.015))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  ylab("% Infected Humans")+
  xlab(NULL)+
  labs(title="5,000 vaccines/day")

plot_Comp_10x = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Ih/Nh, color="No Vaccine"))+
  geom_line(data=model_Vax_NC_10x, aes(y=Ih/Nh, color="Full Dose, without Constraints")) +
  geom_line(data=model50Fatailites_10xvax6mil, aes(y=Ih/Nh, color="Full Dose, with constraints")) +
  geom_line(data=FRAC10Yr_model50Fatailites_10000vax20YrWithLimit, aes(y=Ih/Nh, color="Fractional Dose - 10 Years Immunity")) +
  scale_color_viridis_d("Simulation",labels=c('NoVax'='No Vaccine', "1Yr"="1 Year", "5Yr"="5 Years", "10Yr"="10 Years"))+
  scale_x_continuous(limits=c(0,20))+
  scale_y_continuous(limits=c(0,0.015))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  ylab(NULL)+
  xlab(NULL)+
  labs(title="10,000 vaccines/day")

plot_Comp_15x = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Ih/Nh, color="No Vaccine"))+
  geom_line(data=model_Vax_NC_15x, aes(y=Ih/Nh, color="Full Dose, without Constraints")) +
  geom_line(data=model50Fatailites_15xvax6mil, aes(y=Ih/Nh, color="Full Dose, with constraints")) +
  geom_line(data=FRAC10Yr_model50Fatailites_15000vax20YrWithLimit, aes(y=Ih/Nh, color="Fractional Dose - 10 Years Immunity")) +
  scale_color_viridis_d("Simulation",labels=c('NoVax'='No Vaccine', "1Yr"="1 Year", "5Yr"="5 Years", "10Yr"="10 Years"))+
  scale_x_continuous(limits=c(0,20))+
  scale_y_continuous(limits=c(0,0.015))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  ylab(NULL)+
  xlab("Time (years)")+
  labs(title="15,000 vaccines/day")

plot_Comp_25x = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Ih/Nh, color="No Vaccine"))+
  geom_line(data=model_Vax_NC_25x, aes(y=Ih/Nh, color="Full Dose, without Constraints")) +
  geom_line(data=model50Fatailites_25xvax6mil, aes(y=Ih/Nh, color="Full Dose, with constraints")) +
  geom_line(data=FRAC10Yr_model50Fatailites_25000vax20YrWithLimit, aes(y=Ih/Nh, color="Fractional Dose - 10 Years Immunity")) +
  scale_color_viridis_d("Simulation",labels=c('NoVax'='No Vaccine', "1Yr"="1 Year", "5Yr"="5 Years", "10Yr"="10 Years"))+
  scale_x_continuous(limits=c(0,20))+
  scale_y_continuous(limits=c(0,0.015))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  ylab(NULL)+
  xlab(NULL)+
  labs(title="25,000 vaccines/day")


plot_Comp_50x = ggplot(YFVmodel, aes(x=time/365))+
  geom_line(aes(y=Ih/Nh, color="No Vaccine"))+
  geom_line(data=model_Vax_NC_50x, aes(y=Ih/Nh, color="Full Dose, without Constraints")) +
  geom_line(data=model50Fatailites_50xvax6mil, aes(y=Ih/Nh, color="Full Dose, with constraints")) +
  geom_line(data=FRAC10Yr_model50Fatailites_50000vax20YrWithLimit, aes(y=Ih/Nh, color="Fractional Dose - 10 Years Immunity")) +
  scale_color_viridis_d("Simulation",labels=c('NoVax'='No Vaccine', "1Yr"="1 Year", "5Yr"="5 Years", "10Yr"="10 Years"))+
  scale_x_continuous(limits=c(0,20))+
  scale_y_continuous(limits=c(0,0.015))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  ylab(NULL)+
  xlab(NULL)+
  labs(title="50,000 vaccines/day")

comboFigure = ggarrange(plot_Comp_5x, plot_Comp_10x, plot_Comp_15x,plot_Comp_25x,plot_Comp_50x,
          labels = c("A", "B", "C", "D", "E"),
          ncol = 5, nrow = 1,
          common.legend = TRUE, legend="right")

ggsave("Combined.png", width = 27, height = 5, units = "in", dpi = 300)

subplot(style(plot_Comp_5x, showlegend=F), 
        style(plot_Comp_10x, showlegend=F), 
        style(plot_Comp_15x, showlegend=F),
        style(plot_Comp_25x, showlegend=F),
        plot_Comp_50x, 
        shareY=TRUE, shareX=TRUE, titleY=TRUE, margin=0.01) %>% 
  layout(
    title = list(text = "Comparing Vaccination Coverages", font = list(size = 16))
  )

```

### Comparing Susceptibles
```{r}

sus =  cbind(YFVmodel$time, 
             YFVmodel$Sh/Nh,
             model_Vax_NC_5x$Sh/Nh,
             model_Vax_NC_10x$Sh/Nh,
             model_Vax_NC_15x$Sh/Nh,
             model_Vax_NC_25x$Sh/Nh,
             model_Vax_NC_50x$Sh/Nh, 
             model50Fatailites_5xvax6mil$Sh/Nh,
             model50Fatailites_10xvax6mil$Sh/Nh,
             model50Fatailites_15xvax6mil$Sh/Nh,
             model50Fatailites_25xvax6mil$Sh/Nh,
             model50Fatailites_50xvax6mil$Sh/Nh,
             FRAC1Yr_model50Fatailites_5000vax20YrWithLimit[0:(365*100),'Sh']/Nh,
             FRAC1Yr_model50Fatailites_10000vax20YrWithLimit$Sh/Nh,
             FRAC1Yr_model50Fatailites_15000vax20YrWithLimit$Sh/Nh,
             FRAC1Yr_model50Fatailites_25000vax20YrWithLimit$Sh/Nh,
             FRAC1Yr_model50Fatailites_50000vax20YrWithLimit$Sh/Nh,
             FRAC5Yr_model50Fatailites_5000vax20YrWithLimit[0:(365*100),'Sh']/Nh,
             FRAC5Yr_model50Fatailites_10000vax20YrWithLimit$Sh/Nh,
             FRAC5Yr_model50Fatailites_15000vax20YrWithLimit$Sh/Nh,
             FRAC5Yr_model50Fatailites_25000vax20YrWithLimit$Sh/Nh,
             FRAC5Yr_model50Fatailites_50000vax20YrWithLimit$Sh/Nh,
             FRAC10Yr_model50Fatailites_5000vax20YrWithLimit[0:(365*100),'Sh']/Nh,
             FRAC10Yr_model50Fatailites_10000vax20YrWithLimit$Sh/Nh,
             FRAC10Yr_model50Fatailites_15000vax20YrWithLimit$Sh/Nh,
             FRAC10Yr_model50Fatailites_25000vax20YrWithLimit$Sh/Nh,
             FRAC10Yr_model50Fatailites_50000vax20YrWithLimit$Sh/Nh)          


susDF = as.data.frame(sus)

colnames(susDF) = c("time", 
               "Base",
               "NC5x", "NC10x","NC15x","NC25x","NC50x",
               "Con5x", "Con10x","Con15x","Con25x","Con50x",
               "Frac1-5x", "Frac1-10x","Frac1-15x","Frac1-25x","Frac1-50x",
                "Frac5-5x", "Frac5-10x","Frac5-15x","Frac5-25x","Frac5-50x",
               "Frac10-5x", "Frac10-10x","Frac10-15x","Frac10-25x","Frac10-50x")

susDF_long <- susDF %>%                                   # Apply pivot_longer function
  pivot_longer(c("Base",
               "NC5x", "NC10x","NC15x","NC25x","NC50x",
               "Con5x", "Con10x","Con15x","Con25x","Con50x",
               "Frac1-5x", "Frac1-10x","Frac1-15x","Frac1-25x","Frac1-50x",
                "Frac5-5x", "Frac5-10x","Frac5-15x","Frac5-25x","Frac5-50x",
               "Frac10-5x", "Frac10-10x","Frac10-15x","Frac10-25x","Frac10-50x"))
susDF_long

susDF_long %>% 
  group_by(name) %>% 
  top_n(1, value)

giantPlot = ggplot(subset(susDF_long, name%in% c("NC5x", "NC10x","NC15x","NC25x","NC50x",
               "Con5x", "Con10x","Con15x","Con25x","Con50x",
               "Frac1-5x", "Frac1-10x","Frac1-15x","Frac1-25x","Frac1-50x",
                "Frac5-5x", "Frac5-10x","Frac5-15x","Frac5-25x","Frac5-50x",
               "Frac10-5x", "Frac10-10x","Frac10-15x","Frac10-25x","Frac10-50x")), aes(x=time, y=value, color=name, fill=NULL))+
  geom_line()+
  geom_hline(yintercept=0.2802152)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+ 
  theme_light() +
  scale_color_viridis_d()+
  theme(text=element_text(size=10, face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")

sim.labs = c("Base Model", 
             "Constrainted - 10x",
             "Constrainted - 15x",
             "Constrainted - 25x",
             "Constrainted - 50x",
             "Constrainted - 5x",
             "Fractional Dosing (1 Yr) - 10x",
             "Fractional Dosing (1 Yr) - 15x",
             "Fractional Dosing (1 Yr) - 25x",
             "Fractional Dosing (1 Yr) - 50x",
             "Fractional Dosing (1 Yr) - 5x",
             "Fractional Dosing (5 Yr) - 10x",
             "Fractional Dosing (5 Yr) - 15x",
             "Fractional Dosing (5 Yr) - 25x",
             "Fractional Dosing (5 Yr) - 50x",
             "Fractional Dosing (5 Yr) - 5x",
             "Fractional Dosing (10 Yr) - 10x",
             "Fractional Dosing (10 Yr) - 15x",
             "Fractional Dosing (10 Yr) - 25x",
             "Fractional Dosing (10 Yr) - 50x",
             "Fractional Dosing (10 Yr) - 5x",
             "Unlimted - 10x",
             "Unlimted - 15x",
             "Unlimted - 25x",
             "Unlimted - 50x",
             "Unlimted - 5x")

names(sim.labs) = c("Base", 
             "Con10x",
             "Con15x",
             "Con25x",
             "Con50x",
              "Con5x",
             "Frac1-10x",
             "Frac1-15x",
             "Frac1-25x",
             "Frac1-50x",
             "Frac1-5x",
             "Frac5-10x",
             "Frac5-15x",
             "Frac5-25x",
             "Frac5-50x",
             "Frac5-5x",
             "Frac10-10x",
             "Frac10-15x",
             "Frac10-25x",
             "Frac10-50x",
             "Frac10-5x",
             "NC10x",
             "NC15x",
             "NC25x",
             "NC50x",
             "NC5x")


giantPlot +  facet_wrap(.~ name, ncol=5, labeller = labeller(name=sim.labs)) + theme(legend.position="none") +
   theme(strip.background =element_rect(fill=NA))+
  theme(strip.text = element_text(colour = 'black'))


ggsave("Susc2.png", width = 11, height = 8.5, units = "in", dpi = 300)

```

### Comparing Mortality
```{r}

deaths =  cbind(YFVmodel$time, 
             YFVmodel$CumF,
             model_Vax_NC_5x$CumF,
             model_Vax_NC_10x$CumF,
             model_Vax_NC_15x$CumF,
             model_Vax_NC_25x$CumF,
             model_Vax_NC_50x$CumF, 
             model50Fatailites_5xvax6mil$CumF,
             model50Fatailites_10xvax6mil$CumF,
             model50Fatailites_15xvax6mil$CumF,
             model50Fatailites_25xvax6mil$CumF,
             model50Fatailites_50xvax6mil$CumF,
             FRAC1Yr_model50Fatailites_5000vax20YrWithLimit$CumF,
             FRAC1Yr_model50Fatailites_10000vax20YrWithLimit$CumF,
             FRAC1Yr_model50Fatailites_15000vax20YrWithLimit$CumF,
             FRAC1Yr_model50Fatailites_25000vax20YrWithLimit$CumF,
             FRAC1Yr_model50Fatailites_50000vax20YrWithLimit$CumF,
             FRAC5Yr_model50Fatailites_5000vax20YrWithLimit$CumF,
             FRAC5Yr_model50Fatailites_10000vax20YrWithLimit$CumF,
             FRAC5Yr_model50Fatailites_15000vax20YrWithLimit$CumF,
             FRAC5Yr_model50Fatailites_25000vax20YrWithLimit$CumF,
             FRAC5Yr_model50Fatailites_50000vax20YrWithLimit$CumF,
             FRAC10Yr_model50Fatailites_5000vax20YrWithLimit$CumF,
             FRAC10Yr_model50Fatailites_10000vax20YrWithLimit$CumF,
             FRAC10Yr_model50Fatailites_15000vax20YrWithLimit$CumF,
             FRAC10Yr_model50Fatailites_25000vax20YrWithLimit$CumF,
             FRAC10Yr_model50Fatailites_50000vax20YrWithLimit$CumF)


deathsDF = as.data.frame(deaths)

colnames(deathsDF) = c("time", 
               "Base",
               "NC5x", "NC10x","NC15x","NC25x","NC50x",
               "Con5x", "Con10x","Con15x","Con25x","Con50x",
               "Frac1-5x", "Frac1-10x","Frac1-15x","Frac1-25x","Frac1-50x",
                "Frac5-5x", "Frac5-10x","Frac5-15x","Frac5-25x","Frac5-50x",
               "Frac10-5x", "Frac10-10x","Frac10-15x","Frac10-25x","Frac10-50x")

deathsDF_long <- deathsDF %>%                                   # Apply pivot_longer function
  pivot_longer(c("Base",
               "NC5x", "NC10x","NC15x","NC25x","NC50x",
               "Con5x", "Con10x","Con15x","Con25x","Con50x",
               "Frac1-5x", "Frac1-10x","Frac1-15x","Frac1-25x","Frac1-50x",
                "Frac5-5x", "Frac5-10x","Frac5-15x","Frac5-25x","Frac5-50x",
               "Frac10-5x", "Frac10-10x","Frac10-15x","Frac10-25x","Frac10-50x"))
deathsDF_long

death.labs = c("Base Model", 
             "Constrainted - 10x",
             "Constrainted - 15x",
             "Constrainted - 25x",
             "Constrainted - 50x",
             "Constrainted - 5x",
             "Fractional Dosing (1 Yr) - 10x",
             "Fractional Dosing (1 Yr) - 15",
             "Fractional Dosing (1 Yr) - 25x",
             "Fractional Dosing (1 Yr) - 50x",
             "Fractional Dosing (1 Yr) - 5x",
             "Fractional Dosing (5 Yr) - 10x",
             "Fractional Dosing (5 Yr) - 15",
             "Fractional Dosing (5 Yr) - 25x",
             "Fractional Dosing (5 Yr) - 50x",
             "Fractional Dosing (5 Yr) - 5x",
             "Fractional Dosing (10 Yr) - 10x",
             "Fractional Dosing (10 Yr) - 15",
             "Fractional Dosing (10 Yr) - 25x",
             "Fractional Dosing (10 Yr) - 50x",
             "Fractional Dosing (10 Yr) - 5x",
             "Unlimted - 10x",
             "Unlimted - 15x",
             "Unlimted - 25x",
             "Unlimted - 50x",
             "Unlimted - 5x")

giantPlotDeaths = ggplot(deathsDF_long, aes(x=time/365))+
  geom_line(aes(y=value/1e06, color=name, fill=NULL))+
  scale_y_continuous(limits=c(0,10),expand=c(0,0))+ 
  scale_x_continuous(limits=c(0,100),expand=c(0,0))+ 
  theme_light() +
  scale_color_viridis_d("",labels=death.labs)+
  theme(text=element_text(size=10, face="bold"), 
        legend.position = "bottom",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  ylab("Cumulative Mortality (Millions)")+
  xlab("Time (Years)")

Deaths_CallOut = ggplot(deathsDF_long, aes(x=time/365))+
  geom_line(aes(y=(value/Nh)*100, color=name, fill=NULL))+
  scale_y_continuous(limits=c(0,15),expand=c(0,0))+ 
  scale_x_continuous(limits=c(1,3),expand=c(0,0))+ 
  theme_light() +
  scale_color_viridis_d("",labels=death.labs)+
  theme(text=element_text(size=10, face="bold"), 
        legend.position = "NONE",
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5))+
  ylab("% Total Mortality")+
  xlab("Time (Years)")

CombinedMort = ggarrange(giantPlotDeaths, Deaths_CallOut,
          labels = c("A", "B"),
          ncol = 2, nrow = 1,
          common.legend = TRUE, legend="bottom")


ggsave("Deaths.png", width = 11, height = 8.5, units = "in", dpi = 300)
ggsave("Deaths2.png", width = 20, height = 8.5, units = "in", dpi = 300)

```


##More plots
```{r}
plot1 = ggplot(NULL)+
  geom_line(data=YFVmodel, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label=round(tail(YFVmodel$Sh,1)/Nh, 2), aes(y=tail(YFVmodel$Sh,1)/Nh, x=98), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="No Intervention", size=0.5)

plot2 = ggplot(NULL)+
  geom_line(data=model_Vax_NC_5x, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label=round(tail(model_Vax_NC_5x$Sh,1)/Nh, 2), aes(y=tail(model_Vax_NC_5x$Sh,1)/Nh, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="5,000 w/o limited stockpile", size=0.5)

plot3 = ggplot(NULL)+
  geom_line(data=model_Vax_NC_10x, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label=round(tail(model_Vax_NC_10x$Sh,1)/Nh, 2), aes(y=tail(model_Vax_NC_10x$Sh,1)/Nh, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="10,000 w/o limited stockpile", size=0.5)

plot4 = ggplot(NULL)+
  geom_line(data=model_Vax_NC_15x, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label=round(tail(model_Vax_NC_15x$Sh,1)/Nh, 2), aes(y=tail(model_Vax_NC_15x$Sh,1)/Nh, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="15,000 w/o limited stockpile", size=0.5)

plot5 = ggplot(NULL)+
  geom_line(data=model_Vax_NC_25x, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label="0", aes(y=0.28, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="25,000 w/o limited stockpile", size=0.5)

plot6 = ggplot(NULL)+
  geom_line(data=model_Vax_NC_50x, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label="0", aes(y=0.28, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="50,000 w/o limited stockpile", size=0.5)

plot7 = ggplot(NULL)+
  geom_line(data=model50Fatailites_5xvax6mil , aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label=round(tail(model50Fatailites_5xvax6mil$Sh,1)/Nh, 2), aes(y=tail(model50Fatailites_5xvax6mil$Sh,1)/Nh, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="5,000 with limited stockpile", size=0.5)

plot8 = ggplot(NULL)+
  geom_line(data=model50Fatailites_10xvax6mil, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label=round(tail(model50Fatailites_10xvax6mil$Sh,1)/Nh, 2), aes(y=tail(model50Fatailites_10xvax6mil$Sh,1)/Nh, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="10,000 with limited stockpile", size=0.5)

plot9 = ggplot(NULL)+
  geom_line(data=model50Fatailites_15xvax6mil, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label=round(tail(model50Fatailites_15xvax6mil$Sh,1)/Nh, 2), aes(y=tail(model50Fatailites_15xvax6mil$Sh,1)/Nh, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="15,000 with limited stockpile", size=0.5)

plot10 = ggplot(NULL)+
  geom_line(data=model50Fatailites_25xvax6mil, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label=round(tail(model50Fatailites_25xvax6mil$Sh,1)/Nh, 2), aes(y=tail(model50Fatailites_25xvax6mil$Sh,1)/Nh, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+ 
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="25,000 with limited stockpile", size=0.5)

plot11 = ggplot(NULL)+
  geom_line(data=model50Fatailites_50xvax6mil, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label=round(tail(model50Fatailites_50xvax6mil$Sh,1)/Nh, 2), aes(y=tail(model50Fatailites_50xvax6mil$Sh,1)/Nh, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+ 
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="50,000 with limited stockpile", size=0.5)

plot12 = ggplot(NULL)+
  geom_line(data=FRAC1Yr_model50Fatailites_5000vax20YrWithLimit, aes(x=time/365, y=Sh/Nh))+
  geom_hline(yintercept=0.2802152)+
  geom_text(label=round(tail(FRAC1Yr_model50Fatailites_5000vax20YrWithLimit$Sh,1)/Nh, 2), mapping = 
              aes(y=tail(FRAC1Yr_model50Fatailites_5000vax20YrWithLimit$Sh,1)/Nh, x=95), vjust=-3)+
  scale_y_continuous(limits=c(0,0.60), expand=c(0,0),minor_breaks=seq(0,0.60,0.01))+ 
  theme_light() +
  theme(text=element_text(size=10,  face="bold"), 
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_blank(), 
        panel.border = element_rect(colour = "black", fill=NA, size=0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+
  ylab("% Susceptible")+
  labs(title="Fractional Dosing, 1 Year, 5,000", size=0.5)

megaPlot = ggarrange(plot1, plot2, plot3 ,plot4,plot5, plot6, plot7, plot8, plot9, plot10, plot11,plot12,
          labels = c("A", "B", "C", "D", "E"),
          ncol = 5, nrow = 3,
          common.legend = TRUE, legend="right") 

megaPlot + theme_cowplot(12)
```
* According to the paper The Distribution, Density- and Seasonal Prevalence of Aedes aegypti in West Africa by G. Surtees, January - April, mean weekly larval density increases, declines May - July, increases and  then decreases around October, when the rainy season is done.